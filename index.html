<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Locust Load Test Analysis</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,600;0,9..144,700;1,9..144,300&family=DM+Sans:wght@400;500;600&display=swap');

  :root {
    --bg:       #f7f6f2;
    --surface:  #ffffff;
    --surface2: #f2f0eb;
    --border:   #e2dfd6;
    --border2:  #ccc9bf;
    --ink:      #1a1814;
    --ink2:     #4a4740;
    --ink3:     #7a7570;
    --c1:       #c94040;   /* red  — FALSE config */
    --c2:       #2a8f7f;   /* teal — TRUE W1     */
    --c3:       #b07820;   /* amber— TRUE W4      */
    --crown:    #9a6e10;
    --green:    #2a7a50;
    --accent:   #3a5fc8;
    --mono:     'DM Mono', monospace;
    --display:  'Fraunces', serif;
    --body:     'DM Sans', sans-serif;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--ink);
    font-family: var(--body);
    font-size: 14px;
    line-height: 1.55;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 0 60px;
  }

  /* ── Hero header ── */
  .hero {
    padding: 48px 48px 40px;
    background: var(--ink);
    position: relative;
    overflow: hidden;
  }
  .hero::before {
    content: '';
    position: absolute; inset: 0;
    background:
      radial-gradient(ellipse 60% 80% at 90% 50%, rgba(42,143,127,0.18) 0%, transparent 70%),
      radial-gradient(ellipse 40% 60% at 10% 80%, rgba(58,95,200,0.12) 0%, transparent 60%);
  }
  .hero-inner { position: relative; z-index: 1; }
  .hero-tag {
    display: inline-block; font-family: var(--mono); font-size: 11px; font-weight: 500;
    letter-spacing: 1.5px; text-transform: uppercase; color: var(--c2);
    background: rgba(42,143,127,0.15); border: 1px solid rgba(42,143,127,0.3);
    padding: 4px 10px; border-radius: 3px; margin-bottom: 16px;
  }
  .hero h1 {
    font-family: var(--display); font-size: 36px; font-weight: 300;
    color: #f0ede6; line-height: 1.15; letter-spacing: -0.5px; margin-bottom: 12px;
  }
  .hero h1 em { font-style: italic; color: #a8d8d0; font-weight: 300; }
  .hero-meta { display: flex; gap: 28px; flex-wrap: wrap; margin-top: 20px; }
  .hero-stat { }
  .hero-stat .val { font-family: var(--mono); font-size: 22px; font-weight: 500; color: #f0ede6; }
  .hero-stat .lbl { font-size: 11px; font-family: var(--mono); color: #8a8680; letter-spacing: 0.5px; margin-top: 2px; }
  .hero-divider { width: 1px; background: rgba(255,255,255,0.1); }
  .hero-legend { display: flex; gap: 20px; flex-wrap: wrap; margin-left: auto; align-self: flex-end; }
  .hero-legend-item { display: flex; align-items: center; gap: 7px; font-size: 12px; font-family: var(--mono); color: #9a9690; }
  .hero-legend-dot { width: 8px; height: 8px; border-radius: 50%; }

  /* ── Nav ── */
  .nav-wrap {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    position: sticky; top: 0; z-index: 100;
    box-shadow: 0 1px 0 var(--border), 0 2px 8px rgba(0,0,0,0.05);
  }
  .nav-bar { display: flex; padding: 0 48px; gap: 0; overflow-x: auto; }
  .nav-btn {
    padding: 14px 20px; font-size: 13px; font-family: var(--body); font-weight: 500;
    background: none; border: none; cursor: pointer; color: var(--ink3);
    border-bottom: 2px solid transparent; margin-bottom: -1px;
    transition: all 0.15s; white-space: nowrap; letter-spacing: 0.1px;
  }
  .nav-btn.active { color: var(--ink); border-bottom-color: var(--c2); }
  .nav-btn:hover { color: var(--ink2); }

  /* ── Main ── */
  .main { padding: 36px 48px; display: flex; flex-direction: column; gap: 40px; }
  .section-panel { display: none; flex-direction: column; gap: 36px; }
  .section-panel.active { display: flex; }

  /* ── Section labels ── */
  .label {
    font-size: 11px; font-family: var(--mono); font-weight: 500;
    letter-spacing: 2px; text-transform: uppercase; color: var(--ink3);
    margin-bottom: 16px; display: flex; align-items: center; gap: 12px;
  }
  .label::after { content: ''; flex: 1; height: 1px; background: var(--border); }

  /* ── Cards grid ── */
  .cards3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; background: var(--border); border-radius: 10px; overflow: hidden; box-shadow: 0 1px 4px rgba(0,0,0,0.06); }
  .card { background: var(--surface); padding: 24px; }
  .card-title { font-size: 12px; font-family: var(--mono); font-weight: 500; margin-bottom: 3px; }
  .card-sub { font-size: 11px; font-family: var(--mono); color: var(--ink3); margin-bottom: 18px; }
  .stat-row { display: flex; justify-content: space-between; align-items: baseline; padding: 7px 0; border-bottom: 1px solid var(--border); font-size: 12px; }
  .stat-row:last-child { border-bottom: none; }
  .stat-k { color: var(--ink3); font-family: var(--mono); }
  .stat-v { font-family: var(--mono); font-weight: 600; font-size: 12px; }
  .g { color: var(--green); }
  .w { color: var(--c3); }
  .b { color: var(--c1); }

  /* ── Charts ── */
  .charts2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1px; background: var(--border); border-radius: 10px; overflow: hidden; box-shadow: 0 1px 4px rgba(0,0,0,0.06); }
  .chart-card { background: var(--surface); padding: 24px; }
  .chart-card h3 { font-size: 11px; font-family: var(--mono); font-weight: 500; color: var(--ink3); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px; }
  .chart-wrap { position: relative; height: 210px; }

  /* ── Tables ── */
  .tbl-wrap { background: var(--surface); border-radius: 10px; overflow: hidden; border: 1px solid var(--border); box-shadow: 0 1px 4px rgba(0,0,0,0.06); }
  table { width: 100%; border-collapse: collapse; font-size: 12px; font-family: var(--mono); }
  th { text-align: left; color: var(--ink3); font-weight: 500; padding: 10px 14px; border-bottom: 1px solid var(--border); font-size: 11px; letter-spacing: 0.3px; background: var(--surface2); }
  td { padding: 10px 14px; border-bottom: 1px solid rgba(226,223,214,0.6); color: var(--ink2); vertical-align: middle; }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: #faf9f5; }
  td.num { text-align: right; }
  td.g { color: var(--green); font-weight: 600; }
  td.w { color: var(--c3); font-weight: 600; }
  td.b { color: var(--c1); font-weight: 600; }

  /* ── Champion ── */
  .champion {
    background: var(--surface);
    border: 1px solid rgba(154,110,16,0.3);
    border-radius: 10px; padding: 28px 32px;
    display: flex; gap: 32px; align-items: flex-start; flex-wrap: wrap;
    box-shadow: 0 0 0 4px rgba(154,110,16,0.06), 0 1px 4px rgba(0,0,0,0.06);
    position: relative; overflow: hidden;
  }
  .champion::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0; height: 3px;
    background: linear-gradient(90deg, var(--crown), #d4a843, var(--crown));
  }
  .champ-left { flex: 1; min-width: 260px; }
  .champ-tag { font-size: 10px; font-family: var(--mono); letter-spacing: 1.5px; text-transform: uppercase; color: var(--crown); margin-bottom: 10px; }
  .champ-title { font-family: var(--display); font-size: 20px; font-weight: 600; color: var(--ink); margin-bottom: 8px; line-height: 1.2; }
  .champ-desc { font-size: 13px; color: var(--ink3); line-height: 1.65; }
  .champ-stats { display: flex; gap: 0; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; flex-wrap: wrap; }
  .champ-stat { padding: 14px 20px; border-right: 1px solid var(--border); text-align: center; background: var(--surface2); min-width: 90px; }
  .champ-stat:last-child { border-right: none; }
  .champ-stat .val { font-family: var(--mono); font-size: 18px; font-weight: 600; color: var(--crown); }
  .champ-stat .lbl { font-size: 10px; font-family: var(--mono); color: var(--ink3); letter-spacing: 0.5px; text-transform: uppercase; margin-top: 3px; }

  /* ── Info cards ── */
  .info3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
  .info2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
  .ic {
    padding: 20px 22px; background: var(--surface);
    border-radius: 8px; border: 1px solid var(--border);
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    position: relative; overflow: hidden;
  }
  .ic::after { content: ''; position: absolute; top: 0; left: 0; width: 3px; height: 100%; background: var(--c2); }
  .ic.warn::after { background: var(--c3); }
  .ic.alert::after { background: var(--c1); }
  .ic.gold::after { background: var(--crown); }
  .ic.neutral::after { background: var(--border2); }
  .ic h4 { font-size: 13px; font-weight: 600; color: var(--ink); margin-bottom: 8px; }
  .ic p { font-size: 12px; color: var(--ink3); line-height: 1.65; }
  .ic p strong { color: var(--ink2); font-weight: 600; }
  .ic.warn p strong { color: var(--c3); }
  .ic.alert p strong { color: var(--c1); }
  .ic.gold p strong { color: var(--crown); }

  /* ── Heatmap ── */
  .hm-wrap { background: var(--surface); border-radius: 10px; padding: 24px; border: 1px solid var(--border); box-shadow: 0 1px 4px rgba(0,0,0,0.06); overflow-x: auto; }
  .hm-table { width: 100%; border-collapse: separate; border-spacing: 3px; font-size: 12px; font-family: var(--mono); }
  .hm-table th { padding: 6px 10px; color: var(--ink3); font-size: 11px; font-weight: 500; text-align: center; }
  .hm-table th:first-child { text-align: left; }
  .hm-table td { padding: 8px 12px; border-radius: 4px; text-align: center; font-weight: 600; font-size: 11px; }
  .hm-label { text-align: left !important; color: var(--ink3) !important; background: transparent !important; font-weight: 400 !important; }

  /* ── Badges ── */
  .badge { display: inline-block; padding: 1px 7px; border-radius: 3px; font-size: 10px; font-family: var(--mono); font-weight: 600; margin-left: 5px; vertical-align: middle; }
  .badge.best   { background: rgba(154,110,16,0.12); color: var(--crown); border: 1px solid rgba(154,110,16,0.2); }
  .badge.new    { background: rgba(42,143,127,0.1);  color: var(--c2);    border: 1px solid rgba(42,143,127,0.2); }
  .badge.infra  { background: rgba(176,120,32,0.1);  color: var(--c3);    border: 1px solid rgba(176,120,32,0.2); }
  .badge.worst  { background: rgba(201,64,64,0.08);  color: var(--c1);    border: 1px solid rgba(201,64,64,0.15); }

  /* ── Note ── */
  .note {
    font-size: 12px; color: var(--ink3); font-family: var(--mono);
    margin-top: 10px; line-height: 1.6; padding: 10px 14px;
    background: var(--surface2); border-radius: 6px;
    border-left: 3px solid var(--border2);
  }

  /* ── Endpoint tabs ── */
  .tab-bar { display: flex; border-bottom: 1px solid var(--border); padding: 0 20px; gap: 2px; background: var(--surface2); }
  .tab-btn { padding: 10px 16px; font-size: 12px; font-family: var(--body); font-weight: 500; background: none; border: none; cursor: pointer; color: var(--ink3); border-bottom: 2px solid transparent; margin-bottom: -1px; transition: all 0.15s; }
  .tab-btn.active { color: var(--ink); border-bottom-color: var(--c2); }
  .tab-btn:hover { color: var(--ink2); }
  .tab-panel { display: none; padding: 20px; }
  .tab-panel.active { display: block; }

  /* ── Infra ── */
  .infra2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .infra-block { background: var(--surface); border-radius: 10px; padding: 24px; border: 1px solid var(--border); box-shadow: 0 1px 4px rgba(0,0,0,0.04); }
  .infra-block h4 { font-size: 11px; font-family: var(--mono); font-weight: 500; letter-spacing: 1.5px; text-transform: uppercase; color: var(--ink3); margin-bottom: 14px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
  .infra-row { display: flex; justify-content: space-between; padding: 7px 0; border-bottom: 1px solid rgba(226,223,214,0.5); font-size: 12px; font-family: var(--mono); }
  .infra-row:last-child { border-bottom: none; }
  .infra-k { color: var(--ink3); }
  .infra-v { color: var(--ink); font-weight: 600; }
  .infra-v.changed { color: var(--c3); }

  /* ── Big number callout ── */
  .callouts { display: flex; gap: 1px; background: var(--border); border-radius: 10px; overflow: hidden; box-shadow: 0 1px 4px rgba(0,0,0,0.06); }
  .callout { flex: 1; background: var(--surface); padding: 20px 24px; text-align: center; }
  .callout .big { font-family: var(--display); font-size: 32px; font-weight: 600; color: var(--ink); line-height: 1; margin-bottom: 4px; }
  .callout .big.up { color: var(--green); }
  .callout .big.down { color: var(--c1); }
  .callout .sub { font-size: 11px; font-family: var(--mono); color: var(--ink3); letter-spacing: 0.5px; }

  /* ── Scroll reveal ── */
  @keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
  .section-panel.active > * {
    animation: fadeUp 0.3s ease forwards;
    opacity: 0;
  }
  .section-panel.active > *:nth-child(1) { animation-delay: 0s; }
  .section-panel.active > *:nth-child(2) { animation-delay: 0.06s; }
  .section-panel.active > *:nth-child(3) { animation-delay: 0.12s; }
  .section-panel.active > *:nth-child(4) { animation-delay: 0.18s; }
  .section-panel.active > *:nth-child(5) { animation-delay: 0.22s; }

  footer {
    margin: 0 48px; padding: 20px 0;
    border-top: 1px solid var(--border);
    font-size: 11px; font-family: var(--mono);
    color: var(--ink3); display: flex; justify-content: space-between;
  }
</style>
</head>
<body>

<!-- ── Hero ── -->
<div class="hero">
  <div class="hero-inner">
    <div class="hero-tag">Load Test Report · Feb 18–19 2026</div>
    <h1>Locust Performance Analysis<br><em>BG Isolation, Workers & Job Tuning</em></h1>
    <div class="hero-meta">
      <div class="hero-stat"><div class="val">10</div><div class="lbl">experiments</div></div>
      <div class="hero-divider"></div>
      <div class="hero-stat"><div class="val">3</div><div class="lbl">base configs</div></div>
      <div class="hero-divider"></div>
      <div class="hero-stat"><div class="val">720u</div><div class="lbl">peak load</div></div>
      <div class="hero-divider"></div>
      <div class="hero-stat"><div class="val">0</div><div class="lbl">failures</div></div>
      <div class="hero-legend">
        <div class="hero-legend-item"><div class="hero-legend-dot" style="background:#c94040"></div>FALSE · J10 · W1</div>
        <div class="hero-legend-item"><div class="hero-legend-dot" style="background:#2a8f7f"></div>TRUE · J20 · W1</div>
        <div class="hero-legend-item"><div class="hero-legend-dot" style="background:#b07820"></div>TRUE · J20 · W4</div>
      </div>
    </div>
  </div>
</div>

<!-- ── Nav ── -->
<div class="nav-wrap">
  <div class="nav-bar">
    <button class="nav-btn active" onclick="switchSection('s1',this)">Config Comparison</button>
    <button class="nav-btn" onclick="switchSection('s2',this)">72u Tuning Study</button>
    <button class="nav-btn" onclick="switchSection('s3',this)">Champion & Conclusions</button>
    <button class="nav-btn" onclick="switchSection('s4',this)">Infrastructure</button>
    <button class="nav-btn" onclick="switchSection('s5',this)">Endpoint Breakdown</button>
  </div>
</div>

<div class="main">

<!-- ══════════ S1 — Config Comparison ══════════ -->
<div id="s1" class="section-panel active">

  <div>
    <div class="label">At-a-glance — 720 user peak load</div>
    <div class="callouts">
      <div class="callout"><div class="big">9.76</div><div class="sub">Best RPS (TRUE·W1)</div></div>
      <div class="callout"><div class="big up">+53%</div><div class="sub">RPS vs FALSE config</div></div>
      <div class="callout"><div class="big down">103s</div><div class="sub">FALSE p95 at 720u</div></div>
      <div class="callout"><div class="big">69s</div><div class="sub">TRUE·W1 p95 at 720u</div></div>
      <div class="callout"><div class="big up">0</div><div class="sub">Failures across all runs</div></div>
    </div>
  </div>

  <div>
    <div class="label">Peak load — config summary (720 users)</div>
    <div class="cards3">
      <div class="card">
        <div class="card-title" style="color:var(--c1)">BG_ISO=FALSE · J=10 · W=1</div>
        <div class="card-sub">720u · 180s · 5/s ramp</div>
        <div class="stat-row"><span class="stat-k">Requests</span><span class="stat-v">1,147</span></div>
        <div class="stat-row"><span class="stat-k">RPS</span><span class="stat-v w">6.38</span></div>
        <div class="stat-row"><span class="stat-k">Avg RT</span><span class="stat-v w">23,385ms</span></div>
        <div class="stat-row"><span class="stat-k">p95</span><span class="stat-v b">103,000ms</span></div>
        <div class="stat-row"><span class="stat-k">p99</span><span class="stat-v b">117,000ms</span></div>
        <div class="stat-row"><span class="stat-k">Failures</span><span class="stat-v g">0</span></div>
      </div>
      <div class="card">
        <div class="card-title" style="color:var(--c2)">BG_ISO=TRUE · J=20 · W=1</div>
        <div class="card-sub">720u · 180s · 5/s ramp</div>
        <div class="stat-row"><span class="stat-k">Requests</span><span class="stat-v g">1,757</span></div>
        <div class="stat-row"><span class="stat-k">RPS</span><span class="stat-v g">9.76</span></div>
        <div class="stat-row"><span class="stat-k">Median RT</span><span class="stat-v w">19,000ms</span></div>
        <div class="stat-row"><span class="stat-k">p95</span><span class="stat-v w">69,000ms</span></div>
        <div class="stat-row"><span class="stat-k">p99</span><span class="stat-v b">91,000ms</span></div>
        <div class="stat-row"><span class="stat-k">Failures</span><span class="stat-v g">0</span></div>
      </div>
      <div class="card">
        <div class="card-title" style="color:var(--c3)">BG_ISO=TRUE · J=20 · W=4</div>
        <div class="card-sub">720u · 300s · 5/s ramp</div>
        <div class="stat-row"><span class="stat-k">Requests</span><span class="stat-v">1,587</span></div>
        <div class="stat-row"><span class="stat-k">RPS</span><span class="stat-v g">8.82</span></div>
        <div class="stat-row"><span class="stat-k">Median RT</span><span class="stat-v g">13,000ms</span></div>
        <div class="stat-row"><span class="stat-k">p95</span><span class="stat-v b">78,000ms</span></div>
        <div class="stat-row"><span class="stat-k">p99</span><span class="stat-v b">92,000ms</span></div>
        <div class="stat-row"><span class="stat-k">Failures</span><span class="stat-v g">0</span></div>
      </div>
    </div>
    <div class="note">* FALSE config 720u median shows 700ms — artifact. Only fast create_thread calls completed within the window. Avg RT of 23,385ms is accurate. Agent_message calls were still deeply queued.</div>
  </div>

  <div>
    <div class="label">Performance curves — all load levels</div>
    <div class="charts2">
      <div class="chart-card"><h3>Throughput (RPS) vs users</h3><div class="chart-wrap"><canvas id="rpsChart"></canvas></div></div>
      <div class="chart-card"><h3>Median response time (ms) vs users</h3><div class="chart-wrap"><canvas id="medianChart"></canvas></div></div>
      <div class="chart-card"><h3>p95 response time (ms) vs users</h3><div class="chart-wrap"><canvas id="p95Chart"></canvas></div></div>
      <div class="chart-card"><h3>Total requests completed vs users</h3><div class="chart-wrap"><canvas id="reqChart"></canvas></div></div>
    </div>
  </div>

  <div>
    <div class="label">Endpoint p95 heatmap — 216 users (seconds)</div>
    <div class="hm-wrap">
      <table class="hm-table" id="heatmapTable"></table>
      <div class="note" style="margin-top:12px">All agent_message endpoints are 1.7–2.5× slower on FALSE config at 216 users. BG_ISOLATED=TRUE is the single most impactful configuration parameter.</div>
    </div>
  </div>

  <div>
    <div class="label">Key observations</div>
    <div class="info3">
      <div class="ic gold"><h4>BG_ISO=TRUE is the #1 lever</h4><p>Switching FALSE→TRUE improves RPS by <strong>35–80%</strong> across all load levels. At 216 users: 3.14 → 5.49–5.68 RPS. No other single change comes close.</p></div>
      <div class="ic"><h4>FALSE saturates at 216 users</h4><p>FALSE median jumps 19s→<strong>34s</strong> at 216u. TRUE configs hold at ~21s. FALSE p95 hits 74s vs 41–43s for TRUE. Clear saturation inflection point.</p></div>
      <div class="ic"><h4>W=4 wins median at peak load</h4><p>At 720u, TRUE·W=4 gets <strong>13s median</strong> vs 19s for W=1. But W=1 wins RPS (9.76 vs 8.82). W=4 distributes queue load more evenly but coordination overhead costs throughput.</p></div>
      <div class="ic warn"><h4>FALSE p95/p99 at 720u is severe</h4><p>p95 = <strong>103s</strong>, p99 = 117s. Requests queueing 2–3 minutes. Not suitable for production at this concurrency level.</p></div>
      <div class="ic"><h4>Zero failures across all tests</h4><p>All configs maintained <strong>0% failure rate</strong> at every load level. Service degrades gracefully — latency rises but requests always complete.</p></div>
      <div class="ic"><h4>FastAPI layer is not the bottleneck</h4><p>create_thread calls complete in <strong>650–900ms</strong> at all load levels regardless of config. All pressure is in the background queue processing layer.</p></div>
    </div>
  </div>

</div>

<!-- ══════════ S2 — Tuning Study ══════════ -->
<div id="s2" class="section-panel">

  <div>
    <div class="label">All 72-user experiments ranked</div>
    <div class="tbl-wrap">
      <table>
        <thead>
          <tr><th>Rank</th><th>Config</th><th>W</th><th>J</th><th>Scale</th><th class="num">Reqs</th><th class="num">RPS</th><th class="num">Median</th><th class="num">p95</th><th class="num">p99</th><th>Notes</th></tr>
        </thead>
        <tbody>
          <tr style="background:#fdf9ee">
            <td style="color:var(--crown);font-weight:700">1 ★</td>
            <td style="color:var(--c2)">TRUE · W1 · J20 <span class="badge best">champion</span></td>
            <td class="num g">1</td><td class="num g">20</td><td class="num">2</td>
            <td class="num g">1,141</td><td class="num g">3.80</td><td class="num g">11s</td><td class="num g">29s</td><td class="num g">38s</td>
            <td style="font-size:11px;color:var(--ink3)">Original best config. Unbeaten across all 10 experiments.</td>
          </tr>
          <tr>
            <td>2</td>
            <td>TRUE · W1 · J30 <span class="badge new">new</span><span class="badge infra">scale→4</span></td>
            <td class="num">1</td><td class="num">30</td><td class="num w">4</td>
            <td class="num">1,058</td><td class="num">3.53</td><td class="num g">11s</td><td class="num">30s</td><td class="num">44s</td>
            <td style="font-size:11px;color:var(--ink3)">Scale=4 significantly helped J=30. Median matches champion.</td>
          </tr>
          <tr>
            <td>3</td>
            <td>TRUE · W2 · J25 <span class="badge new">new</span><span class="badge infra">scale→4</span></td>
            <td class="num w">2</td><td class="num">25</td><td class="num w">4</td>
            <td class="num">1,038</td><td class="num">3.47</td><td class="num g">11s</td><td class="num">29s</td><td class="num w">48s</td>
            <td style="font-size:11px;color:var(--ink3)">Closest W=2 got to champion. Good p95, p99 suffers.</td>
          </tr>
          <tr>
            <td>4</td>
            <td>TRUE · W1 · J25 <span class="badge new">new</span><span class="badge infra">scale→4</span></td>
            <td class="num">1</td><td class="num">25</td><td class="num w">4</td>
            <td class="num">1,030</td><td class="num">3.43</td><td class="num">12s</td><td class="num">30s</td><td class="num">44s</td>
            <td style="font-size:11px;color:var(--ink3)">Consistent, J=20 still ahead on all metrics.</td>
          </tr>
          <tr>
            <td>5</td>
            <td>TRUE · W1 · J30 <span class="badge new">new</span><span class="badge infra">scale→4</span></td>
            <td class="num">1</td><td class="num">30</td><td class="num w">4</td>
            <td class="num">1,021</td><td class="num">3.41</td><td class="num g">11s</td><td class="num">31s</td><td class="num">43s</td>
            <td style="font-size:11px;color:var(--ink3)">Re-run variance — autoscaler warmup inconsistency.</td>
          </tr>
          <tr>
            <td>6</td>
            <td>TRUE · W4 · J20</td>
            <td class="num w">4</td><td class="num">20</td><td class="num">2</td>
            <td class="num">890</td><td class="num">2.97</td><td class="num">13s</td><td class="num w">43s</td><td class="num w">57s</td>
            <td style="font-size:11px;color:var(--ink3)">W=4 on scale=2. Contention visible in p95/p99.</td>
          </tr>
          <tr>
            <td>7</td>
            <td>TRUE · W1 · J30 <span class="badge new">new</span></td>
            <td class="num">1</td><td class="num w">30</td><td class="num">2</td>
            <td class="num">945</td><td class="num">3.16</td><td class="num">13s</td><td class="num">38s</td><td class="num w">50s</td>
            <td style="font-size:11px;color:var(--ink3)">J=30 without infra upgrade.</td>
          </tr>
          <tr>
            <td>8</td>
            <td>TRUE · W2 · J20 <span class="badge new">new</span></td>
            <td class="num w">2</td><td class="num">20</td><td class="num">2</td>
            <td class="num">787</td><td class="num b">2.63</td><td class="num">14s</td><td class="num b">47s</td><td class="num b">72s</td>
            <td style="font-size:11px;color:var(--ink3)">W=2 before scale fix. Worse than W=1 on every metric.</td>
          </tr>
          <tr>
            <td>9</td>
            <td>FALSE · W1 · J10 (baseline)</td>
            <td class="num">1</td><td class="num b">10</td><td class="num">2</td>
            <td class="num">792</td><td class="num">2.64</td><td class="num b">19s</td><td class="num">37s</td><td class="num">48s</td>
            <td style="font-size:11px;color:var(--ink3)">Original FALSE baseline.</td>
          </tr>
          <tr>
            <td>10</td>
            <td>TRUE · W1 · J40 <span class="badge new">new</span><span class="badge worst">worst</span></td>
            <td class="num">1</td><td class="num b">40</td><td class="num">2</td>
            <td class="num b">705</td><td class="num b">2.35</td><td class="num">15s</td><td class="num b">56s</td><td class="num b">72s</td>
            <td style="font-size:11px;color:var(--ink3)">CPU saturation. 40 concurrent jobs overwhelmed the container.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div>
    <div class="label">Tuning visualised</div>
    <div class="charts2">
      <div class="chart-card"><h3>RPS by jobs-per-worker (W=1, scale=2)</h3><div class="chart-wrap"><canvas id="tuneRpsChart"></canvas></div></div>
      <div class="chart-card"><h3>p95 by jobs-per-worker (W=1, ms)</h3><div class="chart-wrap"><canvas id="tuneP95Chart"></canvas></div></div>
      <div class="chart-card"><h3>RPS by worker count (J=20, scale=2)</h3><div class="chart-wrap"><canvas id="workerRpsChart"></canvas></div></div>
      <div class="chart-card"><h3>Scale=4 impact on J=30 (RPS + p95)</h3><div class="chart-wrap"><canvas id="scaleChart"></canvas></div></div>
    </div>
  </div>

  <div>
    <div class="label">Why N_WORKERS &gt; 1 doesn't help — the explanation</div>
    <div class="info3">
      <div class="ic gold"><h4>Jobs are I/O-bound, not CPU-bound</h4><p>Each agent_message call spends <strong>90–95% of its time waiting</strong> for the LLM API to respond. Response times of 7–30s are dominated by upstream inference latency. Your queue container CPU sits mostly idle during that wait. More workers add process overhead without adding useful compute capacity.</p></div>
      <div class="ic warn"><h4>Worker coordination has a real cost</h4><p>Each worker is a separate OS process. With W=2, both workers <strong>lock, check, and dequeue</strong> from the same job queue. This inter-process overhead is visible: p99 jumps from 38s → 72s at W=2·scale=2. The coordination tax exceeds the parallelism gain.</p></div>
      <div class="ic"><h4>The LLM API has a concurrency ceiling</h4><p>J=20 perfectly saturates your LLM API's concurrency budget. J=25, 30, 40 all show declining performance because <strong>extra jobs queue up on the LLM side</strong>, not yours. More workers dispatching more jobs just builds a longer upstream queue — not faster responses.</p></div>
      <div class="ic"><h4>Scale=4 helped but didn't break the ceiling</h4><p>Raising queue max scale 2→4 improved J=30: p95 dropped 38s→30s, RPS improved 3.16→3.53. But still can't beat J=20 because the bottleneck is <strong>upstream at the LLM</strong>, not your infrastructure. Scale=4 will show more benefit at 216+ users under sustained pressure.</p></div>
      <div class="ic alert"><h4>J=40 caused CPU saturation</h4><p>40 concurrent jobs on a 4-CPU container caused thrashing. RPS dropped <strong>38%</strong> vs J=20 (3.80→2.35), p95 nearly doubled to 56s. Classic CPU oversubscription — too many runnable threads contending for available cores.</p></div>
      <div class="ic"><h4>When would W=2 actually help?</h4><p>N_WORKERS scales horizontally for <strong>CPU-bound workloads</strong> where each worker genuinely occupies a full CPU core. For your LLM workload W=2·J=25·scale=4 got closest (3.47 RPS, 29s p95) but p99 still suffered. Worth retesting at 216+ users with longer duration to let the autoscaler warm up properly.</p></div>
    </div>
  </div>

</div>

<!-- ══════════ S3 — Champion ══════════ -->
<div id="s3" class="section-panel">

  <div class="champion">
    <div class="champ-left">
      <div class="champ-tag">★ Champion configuration</div>
      <div class="champ-title">BG_ISO=TRUE · J=20 · W=1 · Scale=2</div>
      <div class="champ-desc">Tested across 10 experiments at 72 users. Unbeaten on every metric — RPS, median, p95, p99, and total requests. Optimal for I/O-bound LLM workloads within current infrastructure. The simplest config that happens to be the best.</div>
    </div>
    <div class="champ-stats">
      <div class="champ-stat"><div class="val">3.80</div><div class="lbl">RPS @ 72u</div></div>
      <div class="champ-stat"><div class="val">11s</div><div class="lbl">Median</div></div>
      <div class="champ-stat"><div class="val">29s</div><div class="lbl">p95</div></div>
      <div class="champ-stat"><div class="val">38s</div><div class="lbl">p99</div></div>
      <div class="champ-stat"><div class="val">1,141</div><div class="lbl">Requests</div></div>
      <div class="champ-stat"><div class="val">0</div><div class="lbl">Failures</div></div>
    </div>
  </div>

  <div>
    <div class="label">All findings summarised</div>
    <div class="info3">
      <div class="ic gold"><h4>Finding 1 — BG_ISOLATED dominates</h4><p>FALSE→TRUE improved throughput <strong>35–80%</strong> at all load levels. This is by far the most impactful setting. Always TRUE.</p></div>
      <div class="ic gold"><h4>Finding 2 — J=20 is the sweet spot</h4><p>Every value above J=20 performed worse. The LLM API's own concurrency ceiling is approximately <strong>20 simultaneous requests</strong>.</p></div>
      <div class="ic gold"><h4>Finding 3 — W=1 wins for I/O workloads</h4><p>W=2 and W=4 consistently underperformed W=1 in RPS and tail latency. Worker coordination overhead exceeds parallelism gains when jobs spend 90%+ time waiting on external I/O.</p></div>
      <div class="ic warn"><h4>Finding 4 — Scale=4 is inconsistent at 72u</h4><p>Queue max scale 2→4 showed run-to-run variance (3.53 vs 3.41 RPS, identical configs). Autoscaler warmup takes 60–90s — <strong>significant fraction of a 5-min test</strong>. Expected to help more at 216u with longer duration.</p></div>
      <div class="ic alert"><h4>Finding 5 — Parameter tuning ceiling reached</h4><p>10 experiments confirm J=20·W=1 can't be beaten through parameter tuning alone at 72 users. <strong>Next gains require higher concurrency testing</strong> (216u) with scale=4.</p></div>
      <div class="ic"><h4>Finding 6 — FALSE degrades faster under load</h4><p>FALSE median doubles 19s→34s from 72u to 216u. TRUE configs go 11–13s→21s — a much gentler curve. FALSE is <strong>not suitable for production</strong> at 216+ users.</p></div>
    </div>
  </div>

  <div>
    <div class="label">Recommended config going forward</div>
    <div class="tbl-wrap">
      <table>
        <thead><tr><th>Parameter</th><th>Current best</th><th>Next test</th><th>Rationale</th></tr></thead>
        <tbody>
          <tr><td>BG_ISOLATED</td><td class="g">TRUE</td><td class="g">TRUE</td><td style="color:var(--ink3);font-size:11px">Dominant parameter, always TRUE</td></tr>
          <tr><td>N_JOBS_PER_WORKER</td><td class="g">20</td><td class="g">20</td><td style="color:var(--ink3);font-size:11px">LLM API concurrency ceiling ~20 — don't exceed</td></tr>
          <tr><td>N_WORKERS</td><td class="g">1</td><td class="g">1</td><td style="color:var(--ink3);font-size:11px">I/O-bound workload, single worker is optimal</td></tr>
          <tr><td>Queue max scale</td><td class="w">raised to 4</td><td class="w">keep at 4</td><td style="color:var(--ink3);font-size:11px">Keep 4 for the 216u test — that's where it will matter</td></tr>
          <tr><td>Queue CPU request</td><td>2</td><td>2</td><td style="color:var(--ink3);font-size:11px">Sufficient for J=20 concurrent jobs</td></tr>
          <tr><td>Queue CPU limit</td><td>4</td><td>4</td><td style="color:var(--ink3);font-size:11px">Good burst headroom, don't raise until J=20 ceiling is confirmed</td></tr>
          <tr><td>Container max scale</td><td>2</td><td class="w">consider 4</td><td style="color:var(--ink3);font-size:11px">May become bottleneck at 216+ users</td></tr>
          <tr><td style="color:var(--c2);font-weight:600">Next test</td><td colspan="2" style="color:var(--c2);font-weight:600">W=1 · J=20 · Scale=4 @ 216 users (10 min run)</td><td style="color:var(--ink3);font-size:11px">Sustained pressure needed to see scale=4 benefit clearly</td></tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- ══════════ S4 — Infrastructure ══════════ -->
<div id="s4" class="section-panel">

  <div>
    <div class="label">Current deployment config</div>
    <div class="infra2">
      <div class="infra-block">
        <h4>Container — FastAPI server</h4>
        <div class="infra-row"><span class="infra-k">CPU request per container</span><span class="infra-v">1</span></div>
        <div class="infra-row"><span class="infra-k">CPU limit per container</span><span class="infra-v">2</span></div>
        <div class="infra-row"><span class="infra-k">Memory request (MB)</span><span class="infra-v">2,048</span></div>
        <div class="infra-row"><span class="infra-k">Memory limit (MB)</span><span class="infra-v">4,096</span></div>
        <div class="infra-row"><span class="infra-k">Min scale</span><span class="infra-v">1</span></div>
        <div class="infra-row"><span class="infra-k">Max scale</span><span class="infra-v">2</span></div>
        <div class="note" style="margin-top:14px">HTTP layer only — routes requests and handles API surface. Confirmed not a bottleneck: create_thread calls return 650–900ms at all load levels regardless of config.</div>
      </div>
      <div class="infra-block">
        <h4>Queue — background job worker</h4>
        <div class="infra-row"><span class="infra-k">CPU request per container</span><span class="infra-v">2</span></div>
        <div class="infra-row"><span class="infra-k">CPU limit per container</span><span class="infra-v">4</span></div>
        <div class="infra-row"><span class="infra-k">Memory request (MB)</span><span class="infra-v">2,048</span></div>
        <div class="infra-row"><span class="infra-k">Memory limit (MB)</span><span class="infra-v">4,096</span></div>
        <div class="infra-row"><span class="infra-k">Min scale</span><span class="infra-v">1</span></div>
        <div class="infra-row"><span class="infra-k">Max scale</span><span class="infra-v changed">4 (raised from 2 during testing)</span></div>
        <div class="note" style="margin-top:14px">Where N_WORKERS and N_JOBS_PER_WORKER execute. The real performance bottleneck. Queue CPU limit=4 saturates at J=40. Max scale raised 2→4 mid-study.</div>
      </div>
    </div>
  </div>

  <div>
    <div class="label">Infrastructure findings</div>
    <div class="info3">
      <div class="ic alert"><h4>Max scale=2 was the root W=2 problem</h4><p>With max scale=2, W=2 meant 2 workers sharing 2 pods at full capacity. Workers contended constantly. W=2 got <strong>2.63 RPS</strong> vs W=1's 3.80 — a 31% regression purely from resource contention.</p></div>
      <div class="ic"><h4>Scale=4 enables clean 1:1 worker-to-pod</h4><p>With max scale=4, each worker in a W=2 config gets its own dedicated pod with <strong>full CPU request=2 guaranteed</strong>. This is what the W=2 theory required. W=2·J=25·scale=4 reached 3.47 RPS — much closer to champion.</p></div>
      <div class="ic warn"><h4>Autoscaler warmup causes variance</h4><p>Two identical J=30·scale=4 runs got 3.53 and 3.41 RPS. Pod startup takes <strong>60–90s</strong>. In a 5-minute test that's 20–30% of the test window running under-provisioned. Needs longer test duration to stabilise.</p></div>
      <div class="ic alert"><h4>J=40 hit CPU limit=4 hard</h4><p>40 concurrent jobs on a 4-CPU container caused measurable saturation. RPS dropped 38%, p95 nearly doubled. For J=20, CPU limit=4 is <strong>adequate</strong>. Do not exceed J=20 without raising the CPU limit.</p></div>
      <div class="ic"><h4>Memory is not a constraint</h4><p>No OOM failures or memory-related latency spikes at any load level. Memory limit=4096MB per queue pod is sufficient. <strong>Not a tuning lever</strong> at current scale.</p></div>
      <div class="ic gold"><h4>Recommended next infra test</h4><p>Run <strong>W=1 · J=20 · scale=4 at 216 users for 10 minutes</strong>. Longer duration ensures autoscaler warmup completes. Compare against original 216u result (41s p95, 5.49 RPS) to measure scale=4 benefit under sustained load.</p></div>
    </div>
  </div>

</div>

<!-- ══════════ S5 — Endpoints ══════════ -->
<div id="s5" class="section-panel">
  <div>
    <div class="label">Per-endpoint p95 and request counts — all load levels</div>
    <div class="tbl-wrap">
      <div class="tab-bar">
        <button class="tab-btn active" onclick="switchTab('c1tab',this)">FALSE · J10 · W1</button>
        <button class="tab-btn" onclick="switchTab('c2tab',this)">TRUE · J20 · W1</button>
        <button class="tab-btn" onclick="switchTab('c3tab',this)">TRUE · J20 · W4</button>
      </div>
      <div id="c1tab" class="tab-panel active"></div>
      <div id="c2tab" class="tab-panel"></div>
      <div id="c3tab" class="tab-panel"></div>
    </div>
    <div class="note" style="margin-top:12px">agent_message endpoints represent LLM calls (the bottleneck). create_thread endpoints are lightweight HTTP calls (650–900ms consistently). The split between them confirms all performance pressure is in the queue layer, not the FastAPI server.</div>
  </div>
</div>

</div><!-- end main -->

<footer>
  <span>Locust Load Test · 3 configs · 10 experiments · langsmith_6sense_com</span>
  <span>Feb 19 2026</span>
</footer>

<script>
const C1='#c94040', C2='#2a8f7f', C3='#b07820';
const users=[8,24,72,150,216,720];

const c1={label:'FALSE·J10·W1',color:C1,rps:[0.40,0.96,2.64,2.65,3.14,6.38],median:[17000,19000,19000,22000,34000,null],p95:[39000,52000,37000,46000,74000,103000],requests:[118,289,792,795,940,1147]};
const c2={label:'TRUE·J20·W1', color:C2,rps:[0.38,0.92,3.80,4.16,5.49,9.76],median:[16000,15000,11000,12000,21000,19000],p95:[42000,41000,29000,33000,43000,69000],requests:[115,276,1141,1249,1648,1757]};
const c3={label:'TRUE·J20·W4', color:C3,rps:[0.43,1.30,2.97,3.98,5.68,8.82],median:[14000,12000,13000,13000,21000,13000],p95:[30000,29000,43000,33000,41000,78000],requests:[125,390,890,1195,1704,1587]};

const base={
  responsive:true, maintainAspectRatio:false,
  plugins:{
    legend:{display:false},
    tooltip:{backgroundColor:'#fff',titleColor:'#7a7570',bodyColor:'#1a1814',borderColor:'#e2dfd6',borderWidth:1,padding:10,titleFont:{family:'DM Mono',size:11},bodyFont:{family:'DM Mono',size:12,weight:'600'}}
  },
  scales:{
    x:{grid:{color:'rgba(226,223,214,0.8)'},ticks:{color:'#7a7570',font:{family:'DM Mono',size:10}},title:{display:true,text:'Concurrent Users',color:'#7a7570',font:{family:'DM Mono',size:10}}},
    y:{grid:{color:'rgba(226,223,214,0.8)'},ticks:{color:'#7a7570',font:{family:'DM Mono',size:10}}}
  }
};
const withLeg={...base,plugins:{...base.plugins,legend:{display:true,labels:{color:'#7a7570',font:{family:'DM Mono',size:10},boxWidth:10,padding:14}}}};

function ds(cfg,data){return{label:cfg.label,data,borderColor:cfg.color,backgroundColor:'transparent',borderWidth:2,pointRadius:4,pointHoverRadius:6,tension:0.3};}

new Chart(document.getElementById('rpsChart'),{type:'line',data:{labels:users,datasets:[ds(c1,c1.rps),ds(c2,c2.rps),ds(c3,c3.rps)]},options:withLeg});
new Chart(document.getElementById('medianChart'),{type:'line',data:{labels:users,datasets:[ds(c1,c1.median),ds(c2,c2.median),ds(c3,c3.median)]},options:base});
new Chart(document.getElementById('p95Chart'),{type:'line',data:{labels:users,datasets:[ds(c1,c1.p95),ds(c2,c2.p95),ds(c3,c3.p95)]},options:base});
new Chart(document.getElementById('reqChart'),{type:'bar',data:{labels:users,datasets:[
  {label:c1.label,data:c1.requests,backgroundColor:C1+'44',borderColor:C1,borderWidth:1.5},
  {label:c2.label,data:c2.requests,backgroundColor:C2+'44',borderColor:C2,borderWidth:1.5},
  {label:c3.label,data:c3.requests,backgroundColor:C3+'44',borderColor:C3,borderWidth:1.5},
]},options:withLeg});

// Tuning
const jL=['J=20','J=25','J=30','J=40'];
const jR=[3.80,3.43,3.53,2.35];
const jP=[29000,30000,38000,56000];
new Chart(document.getElementById('tuneRpsChart'),{type:'bar',data:{labels:jL,datasets:[{data:jR,backgroundColor:jR.map((v,i)=>i===0?'#9a6e1033':C2+'33'),borderColor:jR.map((v,i)=>i===0?'#9a6e10':C2),borderWidth:2}]},options:{...base,plugins:{...base.plugins,legend:{display:false}}}});
new Chart(document.getElementById('tuneP95Chart'),{type:'bar',data:{labels:jL,datasets:[{data:jP,backgroundColor:jP.map(v=>v<=29000?'#9a6e1033':v<40000?C2+'33':C1+'33'),borderColor:jP.map(v=>v<=29000?'#9a6e10':v<40000?C2:C1),borderWidth:2}]},options:{...base,plugins:{...base.plugins,legend:{display:false}}}});
new Chart(document.getElementById('workerRpsChart'),{type:'bar',data:{labels:['W=1','W=2','W=4'],datasets:[{data:[3.80,2.63,2.97],backgroundColor:['#9a6e1033',C1+'33',C1+'33'],borderColor:['#9a6e10',C1,C1],borderWidth:2}]},options:{...base,plugins:{...base.plugins,legend:{display:false}}}});
new Chart(document.getElementById('scaleChart'),{type:'bar',data:{labels:['J=30, Scale=2','J=30, Scale=4','J=20, Scale=2'],datasets:[
  {label:'RPS',data:[3.16,3.53,3.80],backgroundColor:[C3+'44',C3+'88','#9a6e1066'],borderColor:[C3,C3,'#9a6e10'],borderWidth:2,yAxisID:'y'},
  {label:'p95 (ms)',data:[38000,30000,29000],backgroundColor:'transparent',borderColor:[C1,C2,'#9a6e10'],borderWidth:2,type:'line',yAxisID:'y1',tension:0.3,pointRadius:5}
]},options:{...withLeg,scales:{...base.scales,
  y:{...base.scales.y,title:{display:true,text:'RPS',color:'#7a7570',font:{family:'DM Mono',size:10}}},
  y1:{position:'right',grid:{display:false},ticks:{color:'#7a7570',font:{family:'DM Mono',size:10}},title:{display:true,text:'p95 ms',color:'#7a7570',font:{family:'DM Mono',size:10}}}
}}});

// Heatmap
const eps216=[
  {name:'advertising_query',c1:79000,c2:45000,c3:45000},
  {name:'complex_query',c1:70000,c2:45000,c3:45000},
  {name:'create_thread_test',c1:82000,c2:47000,c3:43000},
  {name:'keyword_query',c1:82000,c2:37000,c3:40000},
  {name:'multi_turn_part1',c1:74000,c2:33000,c3:39000},
  {name:'multi_turn_part2',c1:72000,c2:42000,c3:40000},
  {name:'quick_question',c1:76000,c2:50000,c3:51000},
  {name:'sixqa_query',c1:73000,c2:37000,c3:32000},
  {name:'streaming_conversation',c1:70000,c2:37000,c3:35000},
  {name:'streaming_followup_p1',c1:80000,c2:52000,c3:42000},
  {name:'streaming_followup_p2',c1:68000,c2:47000,c3:45000},
];
function heatColor(v){
  const r=Math.min(v/100000,1);
  if(r<0.35){const t=r/0.35;return`rgb(${Math.round(42+t*213)},${Math.round(143-t*13)},${Math.round(127-t*127)})`;}
  else{const t=(r-0.35)/0.65;return`rgb(255,${Math.round(140-t*140)},0)`;}
}
function textColor(v){return v>55000?'#fff':'#fff';}
document.getElementById('heatmapTable').innerHTML=`
<thead><tr>
  <th style="text-align:left;min-width:180px">Endpoint</th>
  <th style="color:${C1}">FALSE · J10 · W1</th>
  <th style="color:${C2}">TRUE · J20 · W1</th>
  <th style="color:${C3}">TRUE · J20 · W4</th>
</tr></thead>
<tbody>${eps216.map(e=>`<tr>
  <td class="hm-label">${e.name}</td>
  <td style="background:${heatColor(e.c1)};color:#fff">${(e.c1/1000).toFixed(0)}s</td>
  <td style="background:${heatColor(e.c2)};color:#fff">${(e.c2/1000).toFixed(0)}s</td>
  <td style="background:${heatColor(e.c3)};color:#fff">${(e.c3/1000).toFixed(0)}s</td>
</tr>`).join('')}</tbody>`;

// Endpoint tables
const epData={
  c1:[
    {name:'agent_message_advertising_query',u8:{r:10,p95:37000},u24:{r:22,p95:33000},u72:{r:59,p95:42000},u216:{r:49,p95:79000}},
    {name:'agent_message_complex_query',u8:{r:2,p95:40000},u24:{r:6,p95:44000},u72:{r:18,p95:64000},u216:{r:32,p95:70000}},
    {name:'agent_message_create_thread_test',u8:{r:20,p95:39000},u24:{r:61,p95:41000},u72:{r:172,p95:37000},u216:{r:199,p95:82000}},
    {name:'agent_message_keyword_query',u8:{r:7,p95:20000},u24:{r:20,p95:98000},u72:{r:41,p95:38000},u216:{r:47,p95:82000}},
    {name:'agent_message_multi_turn_part1',u8:{r:10,p95:30000},u24:{r:20,p95:45000},u72:{r:54,p95:30000},u216:{r:47,p95:74000}},
    {name:'agent_message_multi_turn_part2',u8:{r:9,p95:37000},u24:{r:17,p95:87000},u72:{r:45,p95:38000},u216:{r:32,p95:72000}},
    {name:'agent_message_quick_question',u8:{r:2,p95:13000},u24:{r:11,p95:35000},u72:{r:26,p95:33000},u216:{r:31,p95:76000}},
    {name:'agent_message_sixqa_query',u8:{r:6,p95:20000},u24:{r:24,p95:27000},u72:{r:65,p95:31000},u216:{r:56,p95:73000}},
    {name:'agent_message_streaming_conversation',u8:{r:30,p95:41000},u24:{r:49,p95:52000},u72:{r:142,p95:32000},u216:{r:155,p95:70000}},
    {name:'agent_message_streaming_followup_p1',u8:{r:7,p95:41000},u24:{r:20,p95:75000},u72:{r:51,p95:44000},u216:{r:45,p95:80000}},
    {name:'agent_message_streaming_followup_p2',u8:{r:7,p95:38000},u24:{r:15,p95:38000},u72:{r:47,p95:36000},u216:{r:31,p95:68000}},
    {name:'create_thread (all endpoints)',u8:{r:9,p95:930},u24:{r:20,p95:830},u72:{r:72,p95:1000},u216:{r:201,p95:1200}},
  ],
  c2:[
    {name:'agent_message_advertising_query',u8:{r:10,p95:37000},u24:{r:22,p95:33000},u72:{r:68,p95:37000},u216:{r:101,p95:45000}},
    {name:'agent_message_complex_query',u8:{r:2,p95:40000},u24:{r:6,p95:44000},u72:{r:37,p95:30000},u216:{r:63,p95:45000}},
    {name:'agent_message_create_thread_test',u8:{r:21,p95:43000},u24:{r:64,p95:50000},u72:{r:260,p95:29000},u216:{r:373,p95:47000}},
    {name:'agent_message_keyword_query',u8:{r:7,p95:23000},u24:{r:19,p95:43000},u72:{r:65,p95:32000},u216:{r:98,p95:37000}},
    {name:'agent_message_multi_turn_part1',u8:{r:9,p95:54000},u24:{r:20,p95:66000},u72:{r:82,p95:24000},u216:{r:83,p95:33000}},
    {name:'agent_message_multi_turn_part2',u8:{r:9,p95:21000},u24:{r:18,p95:58000},u72:{r:79,p95:36000},u216:{r:76,p95:42000}},
    {name:'agent_message_quick_question',u8:{r:3,p95:34000},u24:{r:7,p95:60000},u72:{r:43,p95:30000},u216:{r:53,p95:50000}},
    {name:'agent_message_sixqa_query',u8:{r:6,p95:42000},u24:{r:18,p95:24000},u72:{r:76,p95:24000},u216:{r:119,p95:37000}},
    {name:'agent_message_streaming_conversation',u8:{r:27,p95:40000},u24:{r:48,p95:25000},u72:{r:237,p95:26000},u216:{r:295,p95:37000}},
    {name:'agent_message_streaming_followup_p1',u8:{r:9,p95:22000},u24:{r:16,p95:47000},u72:{r:64,p95:30000},u216:{r:90,p95:52000}},
    {name:'agent_message_streaming_followup_p2',u8:{r:9,p95:32000},u24:{r:13,p95:96000},u72:{r:58,p95:26000},u216:{r:81,p95:47000}},
    {name:'create_thread (all endpoints)',u8:{r:11,p95:780},u24:{r:23,p95:760},u72:{r:79,p95:830},u216:{r:234,p95:1200}},
  ],
  c3:[
    {name:'agent_message_advertising_query',u8:{r:4,p95:22000},u24:{r:21,p95:30000},u72:{r:56,p95:43000},u216:{r:98,p95:45000}},
    {name:'agent_message_complex_query',u8:{r:4,p95:27000},u24:{r:20,p95:25000},u72:{r:31,p95:44000},u216:{r:53,p95:45000}},
    {name:'agent_message_create_thread_test',u8:{r:26,p95:30000},u24:{r:85,p95:32000},u72:{r:182,p95:46000},u216:{r:402,p95:43000}},
    {name:'agent_message_keyword_query',u8:{r:5,p95:24000},u24:{r:24,p95:28000},u72:{r:58,p95:46000},u216:{r:107,p95:40000}},
    {name:'agent_message_multi_turn_part1',u8:{r:11,p95:34000},u24:{r:30,p95:22000},u72:{r:67,p95:52000},u216:{r:103,p95:39000}},
    {name:'agent_message_multi_turn_part2',u8:{r:11,p95:34000},u24:{r:24,p95:29000},u72:{r:59,p95:51000},u216:{r:86,p95:40000}},
    {name:'agent_message_quick_question',u8:{r:3,p95:14000},u24:{r:12,p95:26000},u72:{r:28,p95:44000},u216:{r:52,p95:51000}},
    {name:'agent_message_sixqa_query',u8:{r:6,p95:30000},u24:{r:32,p95:33000},u72:{r:56,p95:30000},u216:{r:106,p95:32000}},
    {name:'agent_message_streaming_conversation',u8:{r:37,p95:29000},u24:{r:70,p95:25000},u72:{r:179,p95:36000},u216:{r:313,p95:35000}},
    {name:'agent_message_streaming_followup_p1',u8:{r:5,p95:20000},u24:{r:26,p95:34000},u72:{r:53,p95:47000},u216:{r:89,p95:42000}},
    {name:'agent_message_streaming_followup_p2',u8:{r:5,p95:32000},u24:{r:22,p95:29000},u72:{r:49,p95:41000},u216:{r:79,p95:45000}},
    {name:'create_thread (all endpoints)',u8:{r:10,p95:780},u24:{r:22,p95:800},u72:{r:70,p95:1300},u216:{r:226,p95:1200}},
  ]
};

function buildTable(container,eps,color){
  container.innerHTML=`<table>
    <thead>
      <tr><th>Endpoint</th><th class="num" colspan="2">8 users</th><th class="num" colspan="2">24 users</th><th class="num" colspan="2">72 users</th><th class="num" colspan="2">216 users</th></tr>
      <tr><th></th><th class="num" style="color:var(--ink3)">reqs</th><th class="num" style="color:var(--ink3)">p95</th><th class="num" style="color:var(--ink3)">reqs</th><th class="num" style="color:var(--ink3)">p95</th><th class="num" style="color:var(--ink3)">reqs</th><th class="num" style="color:var(--ink3)">p95</th><th class="num" style="color:var(--ink3)">reqs</th><th class="num" style="color:var(--ink3)">p95</th></tr>
    </thead>
    <tbody>${eps.map(e=>`<tr>
      <td style="color:${color};font-weight:500">${e.name}</td>
      <td class="num">${e.u8.r}</td><td class="num">${e.u8.p95>=5000?(e.u8.p95/1000).toFixed(0)+'s':e.u8.p95+'ms'}</td>
      <td class="num">${e.u24.r}</td><td class="num">${e.u24.p95>=5000?(e.u24.p95/1000).toFixed(0)+'s':e.u24.p95+'ms'}</td>
      <td class="num">${e.u72.r}</td><td class="num">${e.u72.p95>=5000?(e.u72.p95/1000).toFixed(0)+'s':e.u72.p95+'ms'}</td>
      <td class="num">${e.u216.r}</td><td class="num">${e.u216.p95>=5000?(e.u216.p95/1000).toFixed(0)+'s':e.u216.p95+'ms'}</td>
    </tr>`).join('')}</tbody>
  </table>`;
}
buildTable(document.getElementById('c1tab'),epData.c1,C1);
buildTable(document.getElementById('c2tab'),epData.c2,C2);
buildTable(document.getElementById('c3tab'),epData.c3,C3);

function switchSection(id,btn){
  document.querySelectorAll('.section-panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
}
function switchTab(id,btn){
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
}
</script>
</body>
</html>
