<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Locust Load Test â€” Full Analysis</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');

  :root {
    --bg:     #0e1117;
    --bg2:    #151920;
    --bg3:    #1c2130;
    --border: #242b3a;
    --c1:     #e05555;
    --c2:     #3db8b0;
    --c3:     #d4a843;
    --crown:  #c9a227;
    --green:  #3d9e6e;
    --text:   #dde1ea;
    --sub:    #8b95a8;
    --muted:  #555f72;
    --mono:   'JetBrains Mono', monospace;
    --sans:   'Inter', sans-serif;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: var(--bg); color: var(--text); font-family: var(--sans); font-size: 14px; line-height: 1.5; min-height: 100vh; }

  /* â”€â”€ Header â”€â”€ */
  header {
    padding: 32px 44px 28px;
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; gap: 32px; flex-wrap: wrap;
  }
  .header-title h1 { font-size: 20px; font-weight: 700; color: var(--text); letter-spacing: -0.3px; }
  .header-title h1 span { color: var(--c2); }
  .header-title p { font-size: 12px; font-family: var(--mono); color: var(--sub); margin-top: 4px; }

  .legend { display: flex; gap: 18px; margin-left: auto; flex-wrap: wrap; }
  .legend-item { display: flex; align-items: center; gap: 7px; font-size: 12px; font-family: var(--mono); color: var(--sub); }
  .legend-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }

  /* â”€â”€ Layout â”€â”€ */
  .main { padding: 32px 44px; display: flex; flex-direction: column; gap: 36px; }

  /* â”€â”€ Nav â”€â”€ */
  .nav-bar {
    display: flex; gap: 2px; border-bottom: 1px solid var(--border);
    margin-bottom: 0; flex-wrap: wrap;
  }
  .nav-btn {
    padding: 10px 18px; font-size: 13px; font-family: var(--sans); font-weight: 500;
    background: none; border: none; cursor: pointer; color: var(--muted);
    border-bottom: 2px solid transparent; margin-bottom: -1px; transition: all 0.15s;
  }
  .nav-btn.active { color: var(--text); border-bottom-color: var(--c2); }
  .nav-btn:hover { color: var(--sub); }
  .section-panel { display: none; }
  .section-panel.active { display: flex; flex-direction: column; gap: 36px; }

  /* â”€â”€ Section labels â”€â”€ */
  .section-label {
    font-size: 11px; font-family: var(--mono); font-weight: 500;
    letter-spacing: 1.5px; text-transform: uppercase; color: var(--muted);
    margin-bottom: 16px; display: flex; align-items: center; gap: 10px;
  }
  .section-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }

  /* â”€â”€ Cards â”€â”€ */
  .cards-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; background: var(--border); border-radius: 10px; overflow: hidden; }
  .config-card { background: var(--bg2); padding: 24px; }
  .config-card h2 { font-size: 13px; font-family: var(--mono); font-weight: 600; margin-bottom: 3px; }
  .config-card .subtitle { font-size: 11px; font-family: var(--mono); color: var(--muted); margin-bottom: 18px; }
  .stat-row { display: flex; justify-content: space-between; align-items: baseline; padding: 7px 0; border-bottom: 1px solid var(--border); font-size: 12px; }
  .stat-row:last-child { border-bottom: none; }
  .stat-label { color: var(--sub); font-family: var(--mono); }
  .stat-val { font-family: var(--mono); font-weight: 600; font-size: 12px; }
  .good { color: var(--green); }
  .warn { color: var(--c3); }
  .bad  { color: var(--c1); }

  /* â”€â”€ Charts â”€â”€ */
  .charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1px; background: var(--border); border-radius: 10px; overflow: hidden; }
  .chart-card { background: var(--bg2); padding: 24px; }
  .chart-card h3 { font-size: 11px; font-family: var(--mono); font-weight: 500; color: var(--sub); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 18px; }
  .chart-wrap { position: relative; height: 220px; }

  /* â”€â”€ Tables â”€â”€ */
  .table-wrap { background: var(--bg2); border-radius: 10px; overflow: hidden; }
  table { width: 100%; border-collapse: collapse; font-size: 12px; font-family: var(--mono); }
  th { text-align: left; color: var(--muted); font-weight: 500; padding: 9px 13px; border-bottom: 1px solid var(--border); font-size: 11px; letter-spacing: 0.3px; }
  td { padding: 10px 13px; border-bottom: 1px solid rgba(36,43,58,0.6); color: var(--text); vertical-align: middle; }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: var(--bg3); }
  td.num { text-align: right; }
  td.good { color: var(--green); font-weight: 600; }
  td.warn { color: var(--c3); font-weight: 600; }
  td.bad  { color: var(--c1); font-weight: 600; }

  /* â”€â”€ Champion â”€â”€ */
  .champion {
    background: var(--bg2);
    border: 1px solid rgba(201,162,39,0.4);
    border-radius: 10px; padding: 28px;
    display: flex; align-items: flex-start; gap: 28px; flex-wrap: wrap;
  }
  .champion-left { flex: 1; min-width: 280px; }
  .champion h2 { font-size: 15px; font-weight: 700; color: var(--crown); margin-bottom: 6px; }
  .champion p { font-size: 13px; color: var(--sub); line-height: 1.65; }
  .champion-stats { display: flex; gap: 28px; margin-top: 20px; flex-wrap: wrap; }
  .champ-stat .val { font-size: 20px; font-weight: 700; color: var(--crown); font-family: var(--mono); }
  .champ-stat .lbl { font-size: 10px; color: var(--muted); font-family: var(--mono); letter-spacing: 1px; text-transform: uppercase; margin-top: 2px; }

  /* â”€â”€ Info cards (insights) â”€â”€ */
  .info-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
  .info-card { padding: 18px 20px; background: var(--bg2); border-radius: 8px; border-top: 2px solid var(--c2); }
  .info-card.warn { border-top-color: var(--c3); }
  .info-card.alert { border-top-color: var(--c1); }
  .info-card.gold { border-top-color: var(--crown); }
  .info-card.neutral { border-top-color: var(--muted); }
  .info-card h4 { font-size: 12px; font-weight: 600; color: var(--text); margin-bottom: 8px; }
  .info-card p { font-size: 12px; color: var(--sub); line-height: 1.6; }
  .info-card p strong { color: var(--text); font-weight: 600; }
  .info-card.warn p strong { color: var(--c3); }
  .info-card.alert p strong { color: var(--c1); }
  .info-card.gold p strong { color: var(--crown); }

  /* â”€â”€ Heatmap â”€â”€ */
  .heatmap-wrap { background: var(--bg2); border-radius: 10px; padding: 24px; overflow-x: auto; }
  .heatmap-table { width: 100%; border-collapse: collapse; font-size: 12px; font-family: var(--mono); }
  .heatmap-table th { padding: 6px 12px; color: var(--muted); font-size: 11px; font-weight: 500; border-bottom: 1px solid var(--border); }
  .heatmap-table td { padding: 7px 12px; border: 1px solid var(--bg); text-align: center; font-weight: 600; font-size: 11px; }
  .hm-label { text-align: left !important; color: var(--sub) !important; font-weight: 400 !important; background: transparent !important; border-left: none !important; border-right: none !important; }

  /* â”€â”€ Tabs â”€â”€ */
  .tab-bar { display: flex; border-bottom: 1px solid var(--border); padding: 0 20px; gap: 2px; }
  .tab-btn { padding: 10px 16px; font-size: 12px; font-family: var(--sans); font-weight: 500; background: none; border: none; cursor: pointer; color: var(--muted); border-bottom: 2px solid transparent; margin-bottom: -1px; transition: all 0.15s; }
  .tab-btn.active { color: var(--text); border-bottom-color: var(--c2); }
  .tab-btn:hover { color: var(--sub); }
  .tab-panel { display: none; padding: 20px; }
  .tab-panel.active { display: block; }

  /* â”€â”€ Badges â”€â”€ */
  .badge { display: inline-block; padding: 1px 7px; border-radius: 3px; font-size: 10px; font-family: var(--mono); font-weight: 600; margin-left: 6px; vertical-align: middle; }
  .badge.best    { background: rgba(201,162,39,0.15); color: var(--crown); }
  .badge.new     { background: rgba(61,184,176,0.12); color: var(--c2); }
  .badge.infra   { background: rgba(212,168,67,0.12); color: var(--c3); }
  .badge.worst   { background: rgba(224,85,85,0.12);  color: var(--c1); }

  .note { font-size: 11px; color: var(--muted); font-family: var(--mono); margin-top: 10px; line-height: 1.6; padding: 10px 14px; background: var(--bg3); border-radius: 6px; border-left: 3px solid var(--border); }

  /* â”€â”€ Infra box â”€â”€ */
  .infra-box { background: var(--bg2); border-radius: 10px; padding: 24px; }
  .infra-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 16px; }
  .infra-section h4 { font-size: 12px; font-weight: 600; color: var(--sub); font-family: var(--mono); margin-bottom: 12px; letter-spacing: 0.5px; text-transform: uppercase; }
  .infra-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 12px; font-family: var(--mono); }
  .infra-row:last-child { border-bottom: none; }
  .infra-key { color: var(--sub); }
  .infra-val { color: var(--text); font-weight: 600; }
  .infra-val.changed { color: var(--c3); }

  footer { padding: 20px 44px; border-top: 1px solid var(--border); color: var(--muted); font-size: 11px; font-family: var(--mono); display: flex; justify-content: space-between; }
</style>
</head>
<body>

<header>
  <div class="header-title">
    <h1>Locust Load Test <span>Analysis</span></h1>
    <p>3 base configs Â· 10 tuning experiments Â· 72-user parameter sweep Â· Feb 18â€“19 2026</p>
  </div>
  <div class="legend">
    <div class="legend-item"><div class="legend-dot" style="background:var(--c1)"></div>FALSE Â· J10 Â· W1</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--c2)"></div>TRUE Â· J20 Â· W1</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--c3)"></div>TRUE Â· J20 Â· W4</div>
  </div>
</header>

<div class="main">

  <div class="nav-bar">
    <button class="nav-btn active" onclick="switchSection('s1',this)">Config Comparison</button>
    <button class="nav-btn" onclick="switchSection('s2',this)">Tuning Study (72u)</button>
    <button class="nav-btn" onclick="switchSection('s3',this)">Champion & Conclusions</button>
    <button class="nav-btn" onclick="switchSection('s4',this)">Infrastructure</button>
    <button class="nav-btn" onclick="switchSection('s5',this)">Endpoint Breakdown</button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 1 â€” Config Comparison
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="s1" class="section-panel active">

    <div>
      <div class="section-label">Peak load summary â€” 720 users</div>
      <div class="cards-grid">
        <div class="config-card">
          <h2 style="color:var(--c1)">BG_ISO=FALSE Â· J=10 Â· W=1</h2>
          <div class="subtitle">720u Â· 180s Â· 5/s ramp</div>
          <div class="stat-row"><span class="stat-label">Total requests</span><span class="stat-val">1,147</span></div>
          <div class="stat-row"><span class="stat-label">RPS</span><span class="stat-val warn">6.38</span></div>
          <div class="stat-row"><span class="stat-label">Avg response time</span><span class="stat-val warn">23,385ms</span></div>
          <div class="stat-row"><span class="stat-label">p95</span><span class="stat-val bad">103,000ms</span></div>
          <div class="stat-row"><span class="stat-label">p99</span><span class="stat-val bad">117,000ms</span></div>
          <div class="stat-row"><span class="stat-label">Failures</span><span class="stat-val good">0</span></div>
        </div>
        <div class="config-card">
          <h2 style="color:var(--c2)">BG_ISO=TRUE Â· J=20 Â· W=1</h2>
          <div class="subtitle">720u Â· 180s Â· 5/s ramp</div>
          <div class="stat-row"><span class="stat-label">Total requests</span><span class="stat-val">1,757</span></div>
          <div class="stat-row"><span class="stat-label">RPS</span><span class="stat-val good">9.76</span></div>
          <div class="stat-row"><span class="stat-label">Median RT</span><span class="stat-val warn">19,000ms</span></div>
          <div class="stat-row"><span class="stat-label">p95</span><span class="stat-val warn">69,000ms</span></div>
          <div class="stat-row"><span class="stat-label">p99</span><span class="stat-val bad">91,000ms</span></div>
          <div class="stat-row"><span class="stat-label">Failures</span><span class="stat-val good">0</span></div>
        </div>
        <div class="config-card">
          <h2 style="color:var(--c3)">BG_ISO=TRUE Â· J=20 Â· W=4</h2>
          <div class="subtitle">720u Â· 300s Â· 5/s ramp</div>
          <div class="stat-row"><span class="stat-label">Total requests</span><span class="stat-val">1,587</span></div>
          <div class="stat-row"><span class="stat-label">RPS</span><span class="stat-val good">8.82</span></div>
          <div class="stat-row"><span class="stat-label">Median RT</span><span class="stat-val good">13,000ms</span></div>
          <div class="stat-row"><span class="stat-label">p95</span><span class="stat-val bad">78,000ms</span></div>
          <div class="stat-row"><span class="stat-label">p99</span><span class="stat-val bad">92,000ms</span></div>
          <div class="stat-row"><span class="stat-label">Failures</span><span class="stat-val good">0</span></div>
        </div>
      </div>
      <div class="note">* FALSE config 720u median reported as 700ms â€” artifact. Only fast create_thread calls completed within the window; agent_message calls were still queued. Avg RT was 23,385ms which is the accurate figure.</div>
    </div>

    <div>
      <div class="section-label">Performance vs concurrency level</div>
      <div class="charts-grid">
        <div class="chart-card"><h3>Throughput â€” RPS vs users</h3><div class="chart-wrap"><canvas id="rpsChart"></canvas></div></div>
        <div class="chart-card"><h3>Median response time (ms) vs users</h3><div class="chart-wrap"><canvas id="medianChart"></canvas></div></div>
        <div class="chart-card"><h3>p95 response time (ms) vs users</h3><div class="chart-wrap"><canvas id="p95Chart"></canvas></div></div>
        <div class="chart-card"><h3>Total requests completed vs users</h3><div class="chart-wrap"><canvas id="reqChart"></canvas></div></div>
      </div>
    </div>

    <div>
      <div class="section-label">Endpoint p95 heatmap â€” 216 users (seconds)</div>
      <div class="heatmap-wrap">
        <table class="heatmap-table" id="heatmapTable"></table>
        <div class="note" style="margin-top:12px">Green = fast, Red = slow. All agent_message endpoints are 2â€“4Ã— slower on the FALSE config at 216 users compared to both TRUE configs. This is the clearest signal that BG_ISOLATED=TRUE is the dominant setting.</div>
      </div>
    </div>

    <div>
      <div class="section-label">Config comparison â€” key observations</div>
      <div class="info-grid">
        <div class="info-card gold">
          <h4>BG_ISO=TRUE is the single biggest lever</h4>
          <p>Switching from FALSE to TRUE improves RPS by <strong>35â€“80%</strong> depending on load level. At 72 users: 2.64 â†’ 3.80 RPS. At 216 users: 3.14 â†’ 5.49â€“5.68 RPS. No other change comes close to this impact.</p>
        </div>
        <div class="info-card">
          <h4>FALSE config saturates at 216 users</h4>
          <p>Median RT on FALSE jumps from 19s at 72u to <strong>34s at 216u</strong> â€” nearly double. Both TRUE configs hold at ~21s. p95 on FALSE hits 74s vs 41â€“43s for TRUE. Clear sign of saturation.</p>
        </div>
        <div class="info-card">
          <h4>W=4 wins on median latency at peak</h4>
          <p>At 720 users, TRUEÂ·W=4 gets <strong>13s median</strong> vs 19s for W=1. But W=1 wins on RPS (9.76 vs 8.82). W=4 distributes queue load more evenly but loses total throughput to coordination overhead.</p>
        </div>
        <div class="info-card warn">
          <h4>FALSE config p95/p99 at 720u is extreme</h4>
          <p>p95 = <strong>103s</strong>, p99 = 117s on FALSE config at 720 users. This is 1.5â€“2Ã— worse than TRUE configs. The system is overwhelmed â€” requests are queueing deeply before being picked up.</p>
        </div>
        <div class="info-card">
          <h4>Zero failures across all configs</h4>
          <p>All three configs maintained <strong>0% failure rate</strong> at every load level. The service degrades gracefully under load â€” latency increases but requests eventually complete. No crashes or hard errors observed.</p>
        </div>
        <div class="info-card">
          <h4>create_thread endpoints are always fast</h4>
          <p>All create_thread calls complete in <strong>650â€“900ms</strong> regardless of config or load. This confirms the FastAPI server layer is not the bottleneck â€” all pressure is in the queue/worker layer.</p>
        </div>
      </div>
    </div>

  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 2 â€” Tuning Study
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="s2" class="section-panel">

    <div>
      <div class="section-label">All 72-user experiments â€” ranked by RPS</div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Rank</th><th>Config</th><th>W</th><th>J</th><th>Scale</th>
              <th class="num">Requests</th><th class="num">RPS</th>
              <th class="num">Median</th><th class="num">p95</th><th class="num">p99</th>
              <th>Observation</th>
            </tr>
          </thead>
          <tbody>
            <tr style="background:rgba(201,162,39,0.04)">
              <td style="color:var(--crown);font-weight:700">1 ðŸ‘‘</td>
              <td>TRUEÂ·J20Â·W1 <span class="badge best">champion</span></td>
              <td class="num good">1</td><td class="num good">20</td><td class="num">2</td>
              <td class="num good">1,141</td><td class="num good">3.80</td>
              <td class="num good">11,000ms</td><td class="num good">29,000ms</td><td class="num good">38,000ms</td>
              <td style="color:var(--sub);font-size:11px">Original best. Unbeaten across all experiments.</td>
            </tr>
            <tr>
              <td>2</td>
              <td>TRUE Â· W=1, J=30 <span class="badge new">new</span><span class="badge infra">scaleâ†‘4</span></td>
              <td class="num">1</td><td class="num">30</td><td class="num warn">4</td>
              <td class="num">1,058</td><td class="num">3.53</td>
              <td class="num good">11,000ms</td><td class="num">30,000ms</td><td class="num">44,000ms</td>
              <td style="color:var(--sub);font-size:11px">Scale=4 significantly improved J=30. Median matches champion.</td>
            </tr>
            <tr>
              <td>3</td>
              <td>TRUE Â· W=2, J=25 <span class="badge new">new</span><span class="badge infra">scaleâ†‘4</span></td>
              <td class="num warn">2</td><td class="num">25</td><td class="num warn">4</td>
              <td class="num">1,038</td><td class="num">3.47</td>
              <td class="num good">11,000ms</td><td class="num">29,000ms</td><td class="num warn">48,000ms</td>
              <td style="color:var(--sub);font-size:11px">Closest W=2 got to champion. Good p95 but p99 suffers.</td>
            </tr>
            <tr>
              <td>4</td>
              <td>TRUE Â· W=1, J=25 <span class="badge new">new</span><span class="badge infra">scaleâ†‘4</span></td>
              <td class="num">1</td><td class="num">25</td><td class="num warn">4</td>
              <td class="num">1,030</td><td class="num">3.43</td>
              <td class="num">12,000ms</td><td class="num">30,000ms</td><td class="num">44,000ms</td>
              <td style="color:var(--sub);font-size:11px">Consistent but J=20 still ahead on every metric.</td>
            </tr>
            <tr>
              <td>5</td>
              <td>TRUE Â· W=1, J=30 <span class="badge new">new</span><span class="badge infra">scaleâ†‘4</span></td>
              <td class="num">1</td><td class="num">30</td><td class="num warn">4</td>
              <td class="num">1,021</td><td class="num">3.41</td>
              <td class="num good">11,000ms</td><td class="num">31,000ms</td><td class="num">43,000ms</td>
              <td style="color:var(--sub);font-size:11px">Re-run of rank 2. Lower due to autoscaler warmup variance.</td>
            </tr>
            <tr>
              <td>6</td>
              <td>TRUEÂ·J20Â·W4</td>
              <td class="num warn">4</td><td class="num">20</td><td class="num">2</td>
              <td class="num">890</td><td class="num">2.97</td>
              <td class="num">13,000ms</td><td class="num warn">43,000ms</td><td class="num warn">57,000ms</td>
              <td style="color:var(--sub);font-size:11px">4 workers on scale=2. Contention visible in p95/p99.</td>
            </tr>
            <tr>
              <td>7</td>
              <td>TRUE Â· W=1, J=30 <span class="badge new">new</span></td>
              <td class="num">1</td><td class="num warn">30</td><td class="num">2</td>
              <td class="num">945</td><td class="num">3.16</td>
              <td class="num">13,000ms</td><td class="num">38,000ms</td><td class="num warn">50,000ms</td>
              <td style="color:var(--sub);font-size:11px">J=30 without infra upgrade. Worse than scale=4 version.</td>
            </tr>
            <tr>
              <td>8</td>
              <td>TRUE Â· W=2, J=20 <span class="badge new">new</span></td>
              <td class="num warn">2</td><td class="num">20</td><td class="num">2</td>
              <td class="num">787</td><td class="num bad">2.63</td>
              <td class="num">14,000ms</td><td class="num bad">47,000ms</td><td class="num bad">72,000ms</td>
              <td style="color:var(--sub);font-size:11px">W=2 without scale fix. Worse than W=1 on all metrics.</td>
            </tr>
            <tr>
              <td>9</td>
              <td>FALSEÂ·J10Â·W1 (baseline)</td>
              <td class="num">1</td><td class="num bad">10</td><td class="num">2</td>
              <td class="num">792</td><td class="num">2.64</td>
              <td class="num bad">19,000ms</td><td class="num">37,000ms</td><td class="num">48,000ms</td>
              <td style="color:var(--sub);font-size:11px">Original FALSE baseline. BG_ISO is the dominant variable.</td>
            </tr>
            <tr>
              <td>10</td>
              <td>TRUE Â· W=1, J=40 <span class="badge new">new</span><span class="badge worst">worst</span></td>
              <td class="num">1</td><td class="num bad">40</td><td class="num">2</td>
              <td class="num bad">705</td><td class="num bad">2.35</td>
              <td class="num">15,000ms</td><td class="num bad">56,000ms</td><td class="num bad">72,000ms</td>
              <td style="color:var(--sub);font-size:11px">Worst of all. Container CPU saturated by 40 concurrent jobs.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div>
      <div class="section-label">Tuning charts â€” 72 users</div>
      <div class="charts-grid">
        <div class="chart-card"><h3>RPS by jobs-per-worker (W=1)</h3><div class="chart-wrap"><canvas id="tuneRpsChart"></canvas></div></div>
        <div class="chart-card"><h3>p95 by jobs-per-worker (W=1, ms)</h3><div class="chart-wrap"><canvas id="tuneP95Chart"></canvas></div></div>
        <div class="chart-card"><h3>RPS by worker count (J=20, scale=2)</h3><div class="chart-wrap"><canvas id="workerRpsChart"></canvas></div></div>
        <div class="chart-card"><h3>Scale=4 impact on J=30</h3><div class="chart-wrap"><canvas id="scaleChart"></canvas></div></div>
      </div>
    </div>

    <div>
      <div class="section-label">Why N_WORKERS &gt; 1 doesn't help â€” detailed explanation</div>
      <div class="info-grid">
        <div class="info-card gold">
          <h4>Jobs are I/O-bound, not CPU-bound</h4>
          <p>Each agent_message call spends roughly <strong>90â€“95% of its time waiting</strong> for the LLM API to respond (7â€“30s response times). The CPU in your queue container is sitting mostly idle during that wait. More workers add process overhead without adding actual compute capacity to do more work.</p>
        </div>
        <div class="info-card warn">
          <h4>Worker coordination has a real cost</h4>
          <p>Each worker is a separate OS process. When W=2, both workers compete for the same job queue â€” they must <strong>lock, check, and dequeue</strong> jobs in a coordinated way. This inter-process overhead costs CPU cycles and adds latency, especially visible in p99 jumping from 38s â†’ 72s at W=2.</p>
        </div>
        <div class="info-card">
          <h4>The upstream LLM has a concurrency ceiling</h4>
          <p>J=20 perfectly saturates your LLM API's concurrency budget. Testing J=25, 30, 40 all showed declining performance because <strong>extra jobs queue up on the LLM side</strong>, not yours. More workers dispatching more jobs just creates a longer queue at the LLM â€” not faster responses.</p>
        </div>
        <div class="info-card">
          <h4>Scale=4 helped but didn't change the ceiling</h4>
          <p>Raising queue max scale 2â†’4 improved J=30: p95 dropped from 38s â†’ 30s, RPS improved from 3.16 â†’ 3.53. But it still couldn't beat J=20 because the bottleneck is <strong>upstream, not infrastructure</strong>. Scale=4 will likely show more benefit at 216+ users where sustained pressure matters.</p>
        </div>
        <div class="info-card alert">
          <h4>J=40 caused textbook CPU saturation</h4>
          <p>With 40 concurrent jobs, the single container had to context-switch between all of them constantly. RPS dropped from 3.80 â†’ <strong>2.35</strong> (worst result), p95 nearly doubled to 56s. This is classic CPU thrashing â€” too many runnable threads for available cores.</p>
        </div>
        <div class="info-card">
          <h4>When would W=2 actually help?</h4>
          <p>N_WORKERS scales horizontally and is designed for <strong>CPU-bound workloads</strong> where each worker genuinely uses its own CPU core. For your LLM workload, W=2 with scale=4 gave the closest result (3.47 RPS, 29s p95) but p99 suffered. Worth retesting at 216+ users where queue pressure is sustained.</p>
        </div>
      </div>
    </div>

  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 3 â€” Champion & Conclusions
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="s3" class="section-panel">

    <div class="champion">
      <div class="champion-left">
        <h2>Champion: BG_ISO=TRUE Â· J=20 Â· W=1 Â· Scale=2</h2>
        <p>Tested across 10 experiments at 72 users. Remained undefeated on every metric â€” RPS, median, p95, p99, and total requests. Optimal for I/O-bound LLM workloads within current infrastructure constraints.</p>
        <div class="champion-stats">
          <div class="champ-stat"><div class="val">3.80</div><div class="lbl">RPS @ 72u</div></div>
          <div class="champ-stat"><div class="val">11s</div><div class="lbl">Median RT</div></div>
          <div class="champ-stat"><div class="val">29s</div><div class="lbl">p95 RT</div></div>
          <div class="champ-stat"><div class="val">38s</div><div class="lbl">p99 RT</div></div>
          <div class="champ-stat"><div class="val">1,141</div><div class="lbl">Requests</div></div>
          <div class="champ-stat"><div class="val">0</div><div class="lbl">Failures</div></div>
        </div>
      </div>
    </div>

    <div>
      <div class="section-label">Summary of all findings</div>
      <div class="info-grid">
        <div class="info-card gold">
          <h4>Finding 1 â€” BG_ISOLATED is the #1 lever</h4>
          <p>Changing BG_ISOLATED FALSEâ†’TRUE improved throughput by <strong>35â€“80%</strong> across all load levels. This is far more impactful than any other parameter. Always run TRUE.</p>
        </div>
        <div class="info-card gold">
          <h4>Finding 2 â€” J=20 is the LLM concurrency sweet spot</h4>
          <p>Every value above J=20 performed worse. J=25 â†’ 3.43 RPS, J=30 â†’ 3.53 (with scale=4 help), J=40 â†’ 2.35. The LLM API's own concurrency ceiling appears to be around <strong>20 simultaneous requests</strong>.</p>
        </div>
        <div class="info-card gold">
          <h4>Finding 3 â€” W=1 is optimal for I/O workloads</h4>
          <p>W=2 and W=4 consistently underperformed W=1 in RPS and tail latency. Coordination overhead between workers exceeds parallelism gains when jobs spend most time waiting on external I/O.</p>
        </div>
        <div class="info-card warn">
          <h4>Finding 4 â€” Scale=4 helps but inconsistently at 72u</h4>
          <p>Queue max scale 2â†’4 helped J=30 significantly but showed run-to-run variance (3.53 vs 3.41 RPS in two identical runs). Autoscaler warmup time is <strong>too slow</strong> to spin up pods within a 5-minute 72-user test. Expected to help more at 216+ users.</p>
        </div>
        <div class="info-card alert">
          <h4>Finding 5 â€” Parameter tuning ceiling reached at 72u</h4>
          <p>After 10 experiments, J=20Â·W=1 remains best. Further gains at 72 users are not achievable through parameter tuning alone. The next real improvement requires <strong>testing at higher concurrency</strong> (216u) with scale=4 to see if infra upgrade pays off.</p>
        </div>
        <div class="info-card">
          <h4>Finding 6 â€” FALSE config degrades faster under load</h4>
          <p>FALSE config's median RT doubles from 19s (72u) to 34s (216u). TRUE configs go from 11â€“13s to 21s â€” a much gentler degradation curve. FALSE config is not suitable for <strong>production at 216+ users</strong>.</p>
        </div>
      </div>
    </div>

    <div>
      <div class="section-label">Recommended config matrix</div>
      <div class="table-wrap">
        <table>
          <thead><tr><th>Parameter</th><th>Current best</th><th>Next test</th><th>Rationale</th></tr></thead>
          <tbody>
            <tr><td>BG_ISOLATED</td><td class="good">TRUE</td><td class="good">TRUE</td><td style="color:var(--sub);font-size:11px">Dominant parameter, always TRUE</td></tr>
            <tr><td>N_JOBS_PER_WORKER</td><td class="good">20</td><td class="good">20</td><td style="color:var(--sub);font-size:11px">LLM concurrency ceiling ~20, don't exceed</td></tr>
            <tr><td>N_WORKERS</td><td class="good">1</td><td class="good">1</td><td style="color:var(--sub);font-size:11px">I/O-bound workload, W=1 optimal</td></tr>
            <tr><td>Queue max scale</td><td class="warn">raised to 4</td><td class="warn">4</td><td style="color:var(--sub);font-size:11px">Keep at 4 for 216u test â€” that's where it will matter</td></tr>
            <tr><td>Queue CPU request</td><td>2</td><td>2</td><td style="color:var(--sub);font-size:11px">Sufficient for J=20 concurrency</td></tr>
            <tr><td>Queue CPU limit</td><td>4</td><td>4</td><td style="color:var(--sub);font-size:11px">Good burst headroom for job processing</td></tr>
            <tr><td>Container max scale</td><td>2</td><td class="warn">consider 4</td><td style="color:var(--sub);font-size:11px">FastAPI layer may become bottleneck at 216+ users</td></tr>
            <tr><td>Next test to run</td><td colspan="2" style="color:var(--c2);font-weight:600">W=1 Â· J=20 Â· Scale=4 at 216 users</td><td style="color:var(--sub);font-size:11px">Real stress point â€” this is where scale=4 should finally show a clear win</td></tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 4 â€” Infrastructure
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="s4" class="section-panel">

    <div class="infra-box">
      <div class="section-label">Deployment configuration (as tested)</div>
      <div class="infra-grid">
        <div class="infra-section">
          <h4>Container (FastAPI server)</h4>
          <div class="infra-row"><span class="infra-key">CPU request per container</span><span class="infra-val">1</span></div>
          <div class="infra-row"><span class="infra-key">CPU limit per container</span><span class="infra-val">2</span></div>
          <div class="infra-row"><span class="infra-key">Memory request (MB)</span><span class="infra-val">2048</span></div>
          <div class="infra-row"><span class="infra-key">Memory limit (MB)</span><span class="infra-val">4096</span></div>
          <div class="infra-row"><span class="infra-key">Min scale</span><span class="infra-val">1</span></div>
          <div class="infra-row"><span class="infra-key">Max scale</span><span class="infra-val">2</span></div>
          <div class="note" style="margin-top:12px">This is the FastAPI HTTP server â€” handles routing and request intake only. Not the performance bottleneck. create_thread calls completing in 650â€“900ms confirm this layer is not stressed.</div>
        </div>
        <div class="infra-section">
          <h4>Queue (background job worker)</h4>
          <div class="infra-row"><span class="infra-key">CPU request per container</span><span class="infra-val">2</span></div>
          <div class="infra-row"><span class="infra-key">CPU limit per container</span><span class="infra-val">4</span></div>
          <div class="infra-row"><span class="infra-key">Memory request (MB)</span><span class="infra-val">2048</span></div>
          <div class="infra-row"><span class="infra-key">Memory limit (MB)</span><span class="infra-val">4096</span></div>
          <div class="infra-row"><span class="infra-key">Min scale</span><span class="infra-val">1</span></div>
          <div class="infra-row"><span class="infra-key">Max scale</span><span class="infra-val changed">4 (raised from 2)</span></div>
          <div class="note" style="margin-top:12px">This is where N_WORKERS and N_JOBS_PER_WORKER run. The real processing bottleneck. Max scale raised from 2â†’4 during tuning study. Each pod gets CPU request=2, limit=4 â€” sufficient for J=20 workload.</div>
        </div>
      </div>
    </div>

    <div>
      <div class="section-label">Infrastructure impact on performance</div>
      <div class="info-grid">
        <div class="info-card warn">
          <h4>Max scale = 2 was the root W=2 problem</h4>
          <p>With max scale=2, running W=2 meant <strong>2 workers sharing 2 pods</strong> â€” at capacity with no headroom. Workers contended for the same resources. W=2 got 2.63 RPS vs W=1's 3.80 â€” a 31% regression from contention alone.</p>
        </div>
        <div class="info-card">
          <h4>Scale=4 enables clean 1:1 worker-to-pod ratio</h4>
          <p>With max scale=4, W=2 now gets <strong>one dedicated pod per worker</strong>, each with CPU request=2 fully available. This is what the W=2 theory required. W=2Â·J=25Â·Scale=4 achieved 3.47 RPS â€” much closer to champion but still behind due to LLM API ceiling.</p>
        </div>
        <div class="info-card">
          <h4>Autoscaler warmup matters at short tests</h4>
          <p>Two identical J=30Â·Scale=4 runs got 3.53 and 3.41 RPS respectively. This variance comes from the autoscaler needing time to <strong>detect load and spin up pods</strong>. In a 5-minute test, if pod startup takes 60â€“90s, you lose 20â€“30% of the test window running under-resourced.</p>
        </div>
        <div class="info-card alert">
          <h4>Queue CPU limit=4 saturates at J=40</h4>
          <p>J=40 concurrent jobs with CPU limit=4 caused measurable CPU saturation â€” RPS dropped 38% vs J=20. The container was context-switching between 40 threads on 4 cores. For J=20, the CPU budget is adequate. Do not exceed J=20 without raising CPU limit.</p>
        </div>
        <div class="info-card">
          <h4>Memory is not a bottleneck</h4>
          <p>No OOM-related failures or latency spikes were observed at any load level. Memory limit=4096MB per queue pod is sufficient for the current workload. <strong>Memory is not a factor</strong> to tune at this time.</p>
        </div>
        <div class="info-card gold">
          <h4>Recommended next infra test</h4>
          <p>Run <strong>W=1 Â· J=20 Â· Scale=4 at 216 users</strong> with a <strong>longer duration (10 min)</strong> to give the autoscaler time to warm up properly. Then compare against the original 216u result (41s p95, 5.49 RPS) to measure the real scale=4 benefit under sustained load.</p>
        </div>
      </div>
    </div>

  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 5 â€” Endpoint Breakdown
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="s5" class="section-panel">
    <div>
      <div class="section-label">Per-endpoint metrics â€” p95 and request counts by load level</div>
      <div class="table-wrap">
        <div class="tab-bar">
          <button class="tab-btn active" onclick="switchTab('c1tab',this)">FALSE Â· J10 Â· W1</button>
          <button class="tab-btn" onclick="switchTab('c2tab',this)">TRUE Â· J20 Â· W1</button>
          <button class="tab-btn" onclick="switchTab('c3tab',this)">TRUE Â· J20 Â· W4</button>
        </div>
        <div id="c1tab" class="tab-panel active"></div>
        <div id="c2tab" class="tab-panel"></div>
        <div id="c3tab" class="tab-panel"></div>
      </div>
      <div class="note" style="margin-top:12px">All agent_message endpoints are the heavy operations (LLM calls). All create_thread endpoints are lightweight (650â€“900ms consistently). The split confirms that queue processing is the bottleneck, not the HTTP layer.</div>
    </div>
  </div>

</div><!-- end main -->

<footer>
  <span>Locust Load Test Â· BG Isolation / Job Worker Comparison Â· 10 experiments across 3 configs</span>
  <span>Updated Feb 19 2026</span>
</footer>

<script>
const C1='#e05555', C2='#3db8b0', C3='#d4a843';
const users = [8, 24, 72, 150, 216, 720];

const c1 = { label:'FALSEÂ·J10Â·W1', color:C1, rps:[0.40,0.96,2.64,2.65,3.14,6.38], median:[17000,19000,19000,22000,34000,null], p95:[39000,52000,37000,46000,74000,103000], requests:[118,289,792,795,940,1147] };
const c2 = { label:'TRUEÂ·J20Â·W1',  color:C2, rps:[0.38,0.92,3.80,4.16,5.49,9.76],  median:[16000,15000,11000,12000,21000,19000], p95:[42000,41000,29000,33000,43000,69000], requests:[115,276,1141,1249,1648,1757] };
const c3 = { label:'TRUEÂ·J20Â·W4',  color:C3, rps:[0.43,1.30,2.97,3.98,5.68,8.82],  median:[14000,12000,13000,13000,21000,13000], p95:[30000,29000,43000,33000,41000,78000], requests:[125,390,890,1195,1704,1587] };

const base = {
  responsive:true, maintainAspectRatio:false,
  plugins:{ legend:{display:false}, tooltip:{ backgroundColor:'#151920', titleColor:'#8b95a8', bodyColor:'#dde1ea', borderColor:'#242b3a', borderWidth:1, padding:10, titleFont:{family:'JetBrains Mono',size:11}, bodyFont:{family:'JetBrains Mono',size:12,weight:'600'} } },
  scales:{
    x:{ grid:{color:'rgba(36,43,58,0.6)'}, ticks:{color:'#555f72',font:{family:'JetBrains Mono',size:11}}, title:{display:true,text:'Concurrent Users',color:'#555f72',font:{family:'JetBrains Mono',size:11}} },
    y:{ grid:{color:'rgba(36,43,58,0.6)'}, ticks:{color:'#555f72',font:{family:'JetBrains Mono',size:11}} }
  }
};
const withLegend = {...base, plugins:{...base.plugins, legend:{display:true, labels:{color:'#8b95a8',font:{family:'JetBrains Mono',size:10},boxWidth:10,padding:14}}}};

function ds(cfg, data) {
  return { label:cfg.label, data, borderColor:cfg.color, backgroundColor:'transparent', borderWidth:2, pointRadius:4, pointHoverRadius:6, tension:0.3 };
}

new Chart(document.getElementById('rpsChart'),    {type:'line', data:{labels:users, datasets:[ds(c1,c1.rps),ds(c2,c2.rps),ds(c3,c3.rps)]}, options:withLegend});
new Chart(document.getElementById('medianChart'), {type:'line', data:{labels:users, datasets:[ds(c1,c1.median),ds(c2,c2.median),ds(c3,c3.median)]}, options:base});
new Chart(document.getElementById('p95Chart'),    {type:'line', data:{labels:users, datasets:[ds(c1,c1.p95),ds(c2,c2.p95),ds(c3,c3.p95)]}, options:base});
new Chart(document.getElementById('reqChart'),    {type:'bar',  data:{labels:users, datasets:[
  {label:c1.label,data:c1.requests,backgroundColor:C1+'55',borderColor:C1,borderWidth:1},
  {label:c2.label,data:c2.requests,backgroundColor:C2+'55',borderColor:C2,borderWidth:1},
  {label:c3.label,data:c3.requests,backgroundColor:C3+'55',borderColor:C3,borderWidth:1},
]}, options:withLegend});

// Tuning charts
const jLabels = ['J=20','J=25','J=30','J=40'];
const jRps    = [3.80, 3.43, 3.53, 2.35];
const jP95    = [29000,30000,38000,56000];
const jBg     = jRps.map((v,i)=>i===0?'#c9a22755':C2+'55');
const jBord   = jRps.map((v,i)=>i===0?'#c9a227':C2);

new Chart(document.getElementById('tuneRpsChart'), {type:'bar', data:{labels:jLabels,datasets:[{data:jRps,backgroundColor:jBg,borderColor:jBord,borderWidth:2}]}, options:{...base,plugins:{...base.plugins,legend:{display:false}}}});
new Chart(document.getElementById('tuneP95Chart'), {type:'bar', data:{labels:jLabels,datasets:[{data:jP95,backgroundColor:jP95.map(v=>v<=29000?'#c9a22755':v<40000?C2+'55':C1+'55'),borderColor:jP95.map(v=>v<=29000?'#c9a227':v<40000?C2:C1),borderWidth:2}]}, options:{...base,plugins:{...base.plugins,legend:{display:false}}}});

new Chart(document.getElementById('workerRpsChart'), {type:'bar', data:{labels:['W=1','W=2','W=4'],datasets:[{data:[3.80,2.63,2.97],backgroundColor:['#c9a22755',C1+'55',C1+'55'],borderColor:['#c9a227',C1,C1],borderWidth:2}]}, options:{...base,plugins:{...base.plugins,legend:{display:false}}}});

new Chart(document.getElementById('scaleChart'), {type:'bar', data:{labels:['J=30, Scale=2','J=30, Scale=4','J=20, Scale=2 (best)'],datasets:[
  {label:'RPS',data:[3.16,3.53,3.80],backgroundColor:[C3+'44',C3+'88','#c9a22766'],borderColor:[C3,C3,'#c9a227'],borderWidth:2,yAxisID:'y'},
  {label:'p95 (ms)',data:[38000,30000,29000],backgroundColor:'transparent',borderColor:[C1,C2,'#c9a227'],borderWidth:2,type:'line',yAxisID:'y1',tension:0.3,pointRadius:5}
]}, options:{...withLegend, scales:{...base.scales,
  y:{...base.scales.y, title:{display:true,text:'RPS',color:'#555f72',font:{family:'JetBrains Mono',size:10}}},
  y1:{position:'right',grid:{display:false},ticks:{color:'#555f72',font:{family:'JetBrains Mono',size:10}},title:{display:true,text:'p95 ms',color:'#555f72',font:{family:'JetBrains Mono',size:10}}}
}}});

// Heatmap
const eps216=[
  {name:'advertising_query',c1:79000,c2:45000,c3:45000},
  {name:'complex_query',c1:70000,c2:45000,c3:45000},
  {name:'create_thread_test',c1:82000,c2:47000,c3:43000},
  {name:'keyword_query',c1:82000,c2:37000,c3:40000},
  {name:'multi_turn_part1',c1:74000,c2:33000,c3:39000},
  {name:'multi_turn_part2',c1:72000,c2:42000,c3:40000},
  {name:'quick_question',c1:76000,c2:50000,c3:51000},
  {name:'sixqa_query',c1:73000,c2:37000,c3:32000},
  {name:'streaming_conversation',c1:70000,c2:37000,c3:35000},
  {name:'streaming_followup_p1',c1:80000,c2:52000,c3:42000},
  {name:'streaming_followup_p2',c1:68000,c2:47000,c3:45000},
];
function heatColor(v){const r=Math.min(v/100000,1);if(r<0.4){const t=r/0.4;return`rgb(${Math.round(40+t*215)},${Math.round(158-t*30)},${Math.round(120-t*120)})`;}else{const t=(r-0.4)/0.6;return`rgb(255,${Math.round(128-t*128)},0)`;}}
document.getElementById('heatmapTable').innerHTML=`<thead><tr><th style="text-align:left">Endpoint</th><th style="color:${C1}">FALSEÂ·J10Â·W1</th><th style="color:${C2}">TRUEÂ·J20Â·W1</th><th style="color:${C3}">TRUEÂ·J20Â·W4</th></tr></thead><tbody>${eps216.map(e=>`<tr><td class="hm-label">${e.name}</td><td style="background:${heatColor(e.c1)};color:#fff">${(e.c1/1000).toFixed(0)}s</td><td style="background:${heatColor(e.c2)};color:#fff">${(e.c2/1000).toFixed(0)}s</td><td style="background:${heatColor(e.c3)};color:#fff">${(e.c3/1000).toFixed(0)}s</td></tr>`).join('')}</tbody>`;

// Endpoint tables
const epData={
  c1:[
    {name:'agent_message_advertising_query',u8:{r:10,p95:37000},u24:{r:22,p95:33000},u72:{r:59,p95:42000},u216:{r:49,p95:79000}},
    {name:'agent_message_complex_query',u8:{r:2,p95:40000},u24:{r:6,p95:44000},u72:{r:18,p95:64000},u216:{r:32,p95:70000}},
    {name:'agent_message_create_thread_test',u8:{r:20,p95:39000},u24:{r:61,p95:41000},u72:{r:172,p95:37000},u216:{r:199,p95:82000}},
    {name:'agent_message_keyword_query',u8:{r:7,p95:20000},u24:{r:20,p95:98000},u72:{r:41,p95:38000},u216:{r:47,p95:82000}},
    {name:'agent_message_multi_turn_part1',u8:{r:10,p95:30000},u24:{r:20,p95:45000},u72:{r:54,p95:30000},u216:{r:47,p95:74000}},
    {name:'agent_message_multi_turn_part2',u8:{r:9,p95:37000},u24:{r:17,p95:87000},u72:{r:45,p95:38000},u216:{r:32,p95:72000}},
    {name:'agent_message_quick_question',u8:{r:2,p95:13000},u24:{r:11,p95:35000},u72:{r:26,p95:33000},u216:{r:31,p95:76000}},
    {name:'agent_message_sixqa_query',u8:{r:6,p95:20000},u24:{r:24,p95:27000},u72:{r:65,p95:31000},u216:{r:56,p95:73000}},
    {name:'agent_message_streaming_conversation',u8:{r:30,p95:41000},u24:{r:49,p95:52000},u72:{r:142,p95:32000},u216:{r:155,p95:70000}},
    {name:'agent_message_streaming_followup_p1',u8:{r:7,p95:41000},u24:{r:20,p95:75000},u72:{r:51,p95:44000},u216:{r:45,p95:80000}},
    {name:'agent_message_streaming_followup_p2',u8:{r:7,p95:38000},u24:{r:15,p95:38000},u72:{r:47,p95:36000},u216:{r:31,p95:68000}},
    {name:'create_thread_* (all)',u8:{r:9,p95:930},u24:{r:20,p95:830},u72:{r:72,p95:1000},u216:{r:201,p95:1200}},
  ],
  c2:[
    {name:'agent_message_advertising_query',u8:{r:10,p95:37000},u24:{r:22,p95:33000},u72:{r:68,p95:37000},u216:{r:101,p95:45000}},
    {name:'agent_message_complex_query',u8:{r:2,p95:40000},u24:{r:6,p95:44000},u72:{r:37,p95:30000},u216:{r:63,p95:45000}},
    {name:'agent_message_create_thread_test',u8:{r:21,p95:43000},u24:{r:64,p95:50000},u72:{r:260,p95:29000},u216:{r:373,p95:47000}},
    {name:'agent_message_keyword_query',u8:{r:7,p95:23000},u24:{r:19,p95:43000},u72:{r:65,p95:32000},u216:{r:98,p95:37000}},
    {name:'agent_message_multi_turn_part1',u8:{r:9,p95:54000},u24:{r:20,p95:66000},u72:{r:82,p95:24000},u216:{r:83,p95:33000}},
    {name:'agent_message_multi_turn_part2',u8:{r:9,p95:21000},u24:{r:18,p95:58000},u72:{r:79,p95:36000},u216:{r:76,p95:42000}},
    {name:'agent_message_quick_question',u8:{r:3,p95:34000},u24:{r:7,p95:60000},u72:{r:43,p95:30000},u216:{r:53,p95:50000}},
    {name:'agent_message_sixqa_query',u8:{r:6,p95:42000},u24:{r:18,p95:24000},u72:{r:76,p95:24000},u216:{r:119,p95:37000}},
    {name:'agent_message_streaming_conversation',u8:{r:27,p95:40000},u24:{r:48,p95:25000},u72:{r:237,p95:26000},u216:{r:295,p95:37000}},
    {name:'agent_message_streaming_followup_p1',u8:{r:9,p95:22000},u24:{r:16,p95:47000},u72:{r:64,p95:30000},u216:{r:90,p95:52000}},
    {name:'agent_message_streaming_followup_p2',u8:{r:9,p95:32000},u24:{r:13,p95:96000},u72:{r:58,p95:26000},u216:{r:81,p95:47000}},
    {name:'create_thread_* (all)',u8:{r:11,p95:780},u24:{r:23,p95:760},u72:{r:79,p95:830},u216:{r:234,p95:1200}},
  ],
  c3:[
    {name:'agent_message_advertising_query',u8:{r:4,p95:22000},u24:{r:21,p95:30000},u72:{r:56,p95:43000},u216:{r:98,p95:45000}},
    {name:'agent_message_complex_query',u8:{r:4,p95:27000},u24:{r:20,p95:25000},u72:{r:31,p95:44000},u216:{r:53,p95:45000}},
    {name:'agent_message_create_thread_test',u8:{r:26,p95:30000},u24:{r:85,p95:32000},u72:{r:182,p95:46000},u216:{r:402,p95:43000}},
    {name:'agent_message_keyword_query',u8:{r:5,p95:24000},u24:{r:24,p95:28000},u72:{r:58,p95:46000},u216:{r:107,p95:40000}},
    {name:'agent_message_multi_turn_part1',u8:{r:11,p95:34000},u24:{r:30,p95:22000},u72:{r:67,p95:52000},u216:{r:103,p95:39000}},
    {name:'agent_message_multi_turn_part2',u8:{r:11,p95:34000},u24:{r:24,p95:29000},u72:{r:59,p95:51000},u216:{r:86,p95:40000}},
    {name:'agent_message_quick_question',u8:{r:3,p95:14000},u24:{r:12,p95:26000},u72:{r:28,p95:44000},u216:{r:52,p95:51000}},
    {name:'agent_message_sixqa_query',u8:{r:6,p95:30000},u24:{r:32,p95:33000},u72:{r:56,p95:30000},u216:{r:106,p95:32000}},
    {name:'agent_message_streaming_conversation',u8:{r:37,p95:29000},u24:{r:70,p95:25000},u72:{r:179,p95:36000},u216:{r:313,p95:35000}},
    {name:'agent_message_streaming_followup_p1',u8:{r:5,p95:20000},u24:{r:26,p95:34000},u72:{r:53,p95:47000},u216:{r:89,p95:42000}},
    {name:'agent_message_streaming_followup_p2',u8:{r:5,p95:32000},u24:{r:22,p95:29000},u72:{r:49,p95:41000},u216:{r:79,p95:45000}},
    {name:'create_thread_* (all)',u8:{r:10,p95:780},u24:{r:22,p95:800},u72:{r:70,p95:1300},u216:{r:226,p95:1200}},
  ]
};

function buildTable(container,eps,color){
  container.innerHTML=`<table>
    <thead>
      <tr><th>Endpoint</th><th class="num" colspan="2">8 users</th><th class="num" colspan="2">24 users</th><th class="num" colspan="2">72 users</th><th class="num" colspan="2">216 users</th></tr>
      <tr><th></th><th class="num" style="color:var(--muted)">reqs</th><th class="num" style="color:var(--muted)">p95</th><th class="num" style="color:var(--muted)">reqs</th><th class="num" style="color:var(--muted)">p95</th><th class="num" style="color:var(--muted)">reqs</th><th class="num" style="color:var(--muted)">p95</th><th class="num" style="color:var(--muted)">reqs</th><th class="num" style="color:var(--muted)">p95</th></tr>
    </thead>
    <tbody>${eps.map(e=>`<tr>
      <td style="color:${color};font-weight:500">${e.name}</td>
      <td class="num">${e.u8.r}</td><td class="num">${e.u8.p95>=1000?(e.u8.p95/1000).toFixed(0)+'s':e.u8.p95+'ms'}</td>
      <td class="num">${e.u24.r}</td><td class="num">${e.u24.p95>=1000?(e.u24.p95/1000).toFixed(0)+'s':e.u24.p95+'ms'}</td>
      <td class="num">${e.u72.r}</td><td class="num">${e.u72.p95>=1000?(e.u72.p95/1000).toFixed(0)+'s':e.u72.p95+'ms'}</td>
      <td class="num">${e.u216.r}</td><td class="num">${e.u216.p95>=1000?(e.u216.p95/1000).toFixed(0)+'s':e.u216.p95+'ms'}</td>
    </tr>`).join('')}</tbody>
  </table>`;
}

buildTable(document.getElementById('c1tab'),epData.c1,C1);
buildTable(document.getElementById('c2tab'),epData.c2,C2);
buildTable(document.getElementById('c3tab'),epData.c3,C3);

function switchSection(id,btn){
  document.querySelectorAll('.section-panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
}
function switchTab(id,btn){
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
}
</script>
</body>
</html>
